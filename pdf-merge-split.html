<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced PDF Merge & Split Tool</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<style>
body{
  font-family:Arial;
  margin:0;
  background:#eef4ff;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}
h1{
  text-align:center;
  color:#007bff;
}
.section{
  background:white;
  padding:20px;
  border-radius:12px;
  margin-top:20px;
  box-shadow:0 0 15px rgba(0,0,0,0.08);
}
.preview-grid{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:15px;
}
.page-box{
  border:1px solid #ccc;
  border-radius:8px;
  padding:5px;
  text-align:center;
  background:#fafafa;
  width:130px;
  cursor:grab;
}
canvas{
  width:100%;
  border-radius:6px;
}
button{
  background:#007bff;
  color:white;
  border:none;
  padding:8px 12px;
  margin-top:10px;
  border-radius:6px;
  cursor:pointer;
}
button:hover{background:#0056b3;}
.controls{
  margin-top:5px;
}
</style>
</head>
<body>

<div class="container">
<h1>Advanced PDF Merge & Split Tool</h1>
<script async="async" data-cfasync="false" src="https://logshandgripquarterback.com/521557a0097cb796fb53391d503caea3/invoke.js"></script>
<div id="container-521557a0097cb796fb53391d503caea3"></div>
<!-- MERGE SECTION -->
<div class="section">
<h2>Merge PDF</h2>
<input type="file" id="mergeInput" multiple accept="application/pdf">
<div class="preview-grid" id="mergePreview"></div>
<button onclick="mergeSelected()">Merge Selected Pages</button>
<script>
  atOptions = {
    'key' : '4afdbe032cc77af781754d77ab0211fb',
    'format' : 'iframe',
    'height' : 90,
    'width' : 728,
    'params' : {}
  };
</script>
<script src="https://logshandgripquarterback.com/4afdbe032cc77af781754d77ab0211fb/invoke.js"></script>
</div>

<!-- SPLIT SECTION -->
<div class="section">
<h2>Split PDF</h2>
<input type="file" id="splitInput" accept="application/pdf">
<div class="preview-grid" id="splitPreview"></div>

<button onclick="downloadSeparate()">Download Selected as Separate PDFs</button>
<button onclick="downloadCombined()">Download Selected as One PDF</button>
</div>
<script async="async" data-cfasync="false" src="https://logshandgripquarterback.com/521557a0097cb796fb53391d503caea3/invoke.js"></script>
<div id="container-521557a0097cb796fb53391d503caea3"></div>
</div>

<script>

const pdfjsLib = window['pdfjs-dist/build/pdf'];
pdfjsLib.GlobalWorkerOptions.workerSrc =
'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

let mergeDocs = [];
let splitDoc = null;

/* ================= PREVIEW RENDER ================= */

async function renderPreview(bytes, containerId, docIndex=null){

  const pdf = await pdfjsLib.getDocument({data:bytes}).promise;
  const container = document.getElementById(containerId);

  for(let i=1;i<=pdf.numPages;i++){
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({scale:0.5});

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = viewport.width;
    canvas.height = viewport.height;

    await page.render({canvasContext:ctx, viewport}).promise;

    const box = document.createElement('div');
    box.className="page-box";
    box.draggable=true;

    box.dataset.page = i-1;
    if(docIndex!==null) box.dataset.doc = docIndex;

    const checkbox = document.createElement("input");
    checkbox.type="checkbox";
    checkbox.checked=true;

    box.appendChild(canvas);
    box.appendChild(checkbox);
    container.appendChild(box);

    addDragEvents(box, container);
  }
}

/* ================= MERGE ================= */

document.getElementById('mergeInput').addEventListener('change', async function(e){

  const files = e.target.files;
  mergeDocs=[];
  document.getElementById("mergePreview").innerHTML="";

  for(let i=0;i<files.length;i++){
    const bytes = await files[i].arrayBuffer();
    mergeDocs.push(await PDFLib.PDFDocument.load(bytes));
    renderPreview(bytes,"mergePreview",i);
  }
});

async function mergeSelected(){

  const { PDFDocument } = PDFLib;
  const newPdf = await PDFDocument.create();

  const boxes = document.querySelectorAll("#mergePreview .page-box");

  for(let box of boxes){
    if(box.querySelector("input").checked){
      const docIndex=parseInt(box.dataset.doc);
      const pageIndex=parseInt(box.dataset.page);

      const [page] = await newPdf.copyPages(mergeDocs[docIndex],[pageIndex]);
      newPdf.addPage(page);
    }
  }

  const bytes = await newPdf.save();
  downloadFile(bytes,"merged.pdf");
}

/* ================= SPLIT ================= */

document.getElementById('splitInput').addEventListener('change', async function(e){

  const file = e.target.files[0];
  if(!file) return;

  const bytes = await file.arrayBuffer();
  splitDoc = await PDFLib.PDFDocument.load(bytes);

  document.getElementById("splitPreview").innerHTML="";
  renderPreview(bytes,"splitPreview");
});

async function downloadSeparate(){

  const boxes=document.querySelectorAll("#splitPreview .page-box");

  for(let i=0;i<boxes.length;i++){
    if(boxes[i].querySelector("input").checked){
      const pageIndex=parseInt(boxes[i].dataset.page);

      const newPdf=await PDFLib.PDFDocument.create();
      const [page]=await newPdf.copyPages(splitDoc,[pageIndex]);
      newPdf.addPage(page);

      const bytes=await newPdf.save();
      downloadFile(bytes,`page-${i+1}.pdf`);
    }
  }
}

async function downloadCombined(){

  const { PDFDocument } = PDFLib;
  const newPdf=await PDFDocument.create();

  const boxes=document.querySelectorAll("#splitPreview .page-box");

  for(let box of boxes){
    if(box.querySelector("input").checked){
      const pageIndex=parseInt(box.dataset.page);
      const [page]=await newPdf.copyPages(splitDoc,[pageIndex]);
      newPdf.addPage(page);
    }
  }

  const bytes=await newPdf.save();
  downloadFile(bytes,"selected-pages.pdf");
}

/* ================= DRAG DROP ================= */

function addDragEvents(box,container){

  box.addEventListener('dragstart',()=>box.classList.add("dragging"));
  box.addEventListener('dragend',()=>box.classList.remove("dragging"));

  container.addEventListener('dragover',e=>{
    e.preventDefault();
    const dragging=document.querySelector(".dragging");
    const afterElement=getDragAfterElement(container,e.clientX);
    if(afterElement==null){
      container.appendChild(dragging);
    }else{
      container.insertBefore(dragging,afterElement);
    }
  });
}

function getDragAfterElement(container,x){
  const elements=[...container.querySelectorAll(".page-box:not(.dragging)")];
  return elements.reduce((closest,child)=>{
    const box=child.getBoundingClientRect();
    const offset=x-box.left-box.width/2;
    if(offset<0 && offset>closest.offset){
      return {offset:offset,element:child};
    }else{
      return closest;
    }
  },{offset:Number.NEGATIVE_INFINITY}).element;
}

/* ================= DOWNLOAD ================= */

function downloadFile(bytes,filename){
  const blob=new Blob([bytes],{type:"application/pdf"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download=filename;
  link.click();
}

</script>
</body>
</html>
