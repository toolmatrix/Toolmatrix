<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional PDF Merge & Split Tool</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<style>
body{
  font-family: Arial;
  margin:0;
  background:#eef4ff;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}
h1{
  text-align:center;
  color:#007bff;
}
.section{
  background:white;
  padding:20px;
  border-radius:12px;
  margin-top:20px;
  box-shadow:0 0 15px rgba(0,0,0,0.08);
}
button{
  background:#007bff;
  color:white;
  border:none;
  padding:10px 15px;
  margin-top:10px;
  border-radius:6px;
  cursor:pointer;
}
button:hover{
  background:#0056b3;
}
.preview-grid{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:15px;
}
.page-box{
  border:1px solid #ccc;
  padding:5px;
  border-radius:8px;
  text-align:center;
  background:#fafafa;
}
canvas{
  width:120px;
  border-radius:6px;
}
.controls button{
  margin:3px;
  padding:4px 8px;
  font-size:12px;
}
</style>
</head>
<body>

<div class="container">
<h1>PDF Merge & Split Tool</h1>

<!-- MERGE SECTION -->
<div class="section">
<h2>Merge PDF Files</h2>
<input type="file" id="mergeInput" multiple accept="application/pdf">
<button onclick="mergePDFs()">Merge & Download</button>
</div>

<!-- SPLIT SECTION -->
<div class="section">
<h2>Split PDF</h2>
<input type="file" id="splitInput" accept="application/pdf">
<div class="preview-grid" id="preview"></div>
<button onclick="downloadSplit()">Download Split Pages</button>
</div>

</div>

<script>

let splitPdfDoc = null;
let splitPages = [];

/* ================= MERGE FUNCTION ================= */

async function mergePDFs(){
  const { PDFDocument } = PDFLib;
  const files = document.getElementById('mergeInput').files;

  if(files.length < 2){
    alert("Select at least 2 PDFs");
    return;
  }

  const mergedPdf = await PDFDocument.create();

  for(let file of files){
    const bytes = await file.arrayBuffer();
    const pdf = await PDFDocument.load(bytes);
    const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
    pages.forEach(p => mergedPdf.addPage(p));
  }

  const mergedBytes = await mergedPdf.save();
  downloadFile(mergedBytes, "merged.pdf");
}

/* ================= SPLIT FUNCTION ================= */

document.getElementById('splitInput').addEventListener('change', async function(e){

  const file = e.target.files[0];
  if(!file) return;

  const bytes = await file.arrayBuffer();
  splitPdfDoc = await PDFLib.PDFDocument.load(bytes);

  const pdfjsLib = window['pdfjs-dist/build/pdf'];
  pdfjsLib.GlobalWorkerOptions.workerSrc =
  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

  const loadingTask = pdfjsLib.getDocument({data:bytes});
  const pdf = await loadingTask.promise;

  splitPages = [];
  document.getElementById('preview').innerHTML = "";

  for(let i=1;i<=pdf.numPages;i++){
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({scale:1});
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');

    canvas.height = viewport.height;
    canvas.width = viewport.width;

    await page.render({canvasContext:context, viewport:viewport}).promise;

    addPreview(canvas, i-1);
  }
});

function addPreview(canvas, index){

  splitPages.push(index);

  const box = document.createElement('div');
  box.className = "page-box";
  box.dataset.index = index;

  const controls = document.createElement('div');
  controls.className = "controls";

  const up = document.createElement('button');
  up.innerText = "↑";
  up.onclick = () => movePage(box, -1);

  const down = document.createElement('button');
  down.innerText = "↓";
  down.onclick = () => movePage(box, 1);

  controls.appendChild(up);
  controls.appendChild(down);

  box.appendChild(canvas);
  box.appendChild(controls);

  document.getElementById('preview').appendChild(box);
}

function movePage(box, direction){
  const container = document.getElementById('preview');
  if(direction === -1 && box.previousElementSibling){
    container.insertBefore(box, box.previousElementSibling);
  }
  if(direction === 1 && box.nextElementSibling){
    container.insertBefore(box.nextElementSibling, box);
  }
}

/* DOWNLOAD SPLIT */

async function downloadSplit(){
  if(!splitPdfDoc){
    alert("Upload a PDF first");
    return;
  }

  const { PDFDocument } = PDFLib;
  const container = document.getElementById('preview');
  const boxes = container.querySelectorAll('.page-box');

  for(let i=0;i<boxes.length;i++){
    const pageIndex = parseInt(boxes[i].dataset.index);

    const newPdf = await PDFDocument.create();
    const [page] = await newPdf.copyPages(splitPdfDoc, [pageIndex]);
    newPdf.addPage(page);

    const bytes = await newPdf.save();
    downloadFile(bytes, `page-${i+1}.pdf`);
  }
}

function downloadFile(bytes, filename){
  const blob = new Blob([bytes], {type:"application/pdf"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
}

</script>
</body>
</html>
