<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Image ⇄ PDF Converter</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<style>
body{
  font-family:Arial;
  margin:0;
  background:#eef4ff;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}
h1{
  text-align:center;
  color:#007bff;
}
.section{
  background:white;
  padding:20px;
  border-radius:12px;
  margin-top:20px;
  box-shadow:0 0 15px rgba(0,0,0,0.08);
}
.preview-grid{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:15px;
}
.preview-box{
  width:140px;
  border:1px solid #ccc;
  border-radius:8px;
  padding:5px;
  background:#fafafa;
  text-align:center;
}
.preview-box img, canvas{
  width:100%;
  border-radius:6px;
}
button{
  background:#007bff;
  color:white;
  border:none;
  padding:8px 12px;
  margin-top:10px;
  border-radius:6px;
  cursor:pointer;
}
button:hover{background:#0056b3;}
select,input{
  margin-top:10px;
}
</style>
</head>
<body>

<div class="container">
<h1>Advanced Image ⇄ PDF Converter</h1>

<!-- IMAGE TO PDF -->
<div class="section">
<h2>Image → PDF</h2>
<input type="file" id="imgInput" multiple accept="image/*">

<select id="pageSize">
<option value="original">Original Size</option>
<option value="A4">A4</option>
</select>

<input type="number" id="margin" placeholder="Margin (px)" value="10">

<div class="preview-grid" id="imgPreview"></div>

<button onclick="createPDF()">Download PDF</button>
<script async="async" data-cfasync="false" src="https://logshandgripquarterback.com/521557a0097cb796fb53391d503caea3/invoke.js"></script>
<div id="container-521557a0097cb796fb53391d503caea3"></div>
<script>
  atOptions = {
    'key' : '4afdbe032cc77af781754d77ab0211fb',
    'format' : 'iframe',
    'height' : 90,
    'width' : 728,
    'params' : {}
  };
</script>
<script src="https://logshandgripquarterback.com/4afdbe032cc77af781754d77ab0211fb/invoke.js"></script>
<script src="https://logshandgripquarterback.com/2f/8e/73/2f8e73ae0d35ba6e793c280b73571187.js"></script>
</div>

<!-- PDF TO IMAGE -->
<div class="section">
<h2>PDF → Image</h2>
<input type="file" id="pdfInput" accept="application/pdf">

<select id="imgFormat">
<option value="image/png">PNG</option>
<option value="image/jpeg">JPG</option>
<option value="image/webp">WEBP</option>
</select>

<input type="range" id="imgQuality" min="0.5" max="1" step="0.1" value="0.9">

<div class="preview-grid" id="pdfPreview"></div>

<button onclick="downloadAllImages()">Download All Images</button>
</div>
<script async="async" data-cfasync="false" src="https://logshandgripquarterback.com/521557a0097cb796fb53391d503caea3/invoke.js"></script>
<div id="container-521557a0097cb796fb53391d503caea3"></div>
  <script>
  atOptions = {
    'key' : '4afdbe032cc77af781754d77ab0211fb',
    'format' : 'iframe',
    'height' : 90,
    'width' : 728,
    'params' : {}
  };
</script>
<script src="https://logshandgripquarterback.com/4afdbe032cc77af781754d77ab0211fb/invoke.js"></script>

</div>

<script>

const pdfjsLib = window['pdfjs-dist/build/pdf'];
pdfjsLib.GlobalWorkerOptions.workerSrc =
'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

/* ================= IMAGE → PDF ================= */

let imageFiles=[];

document.getElementById('imgInput').addEventListener('change',function(e){
  imageFiles=[...e.target.files];
  const preview=document.getElementById("imgPreview");
  preview.innerHTML="";

  imageFiles.forEach(file=>{
    const reader=new FileReader();
    reader.onload=function(ev){
      const box=document.createElement("div");
      box.className="preview-box";
      const img=document.createElement("img");
      img.src=ev.target.result;
      box.appendChild(img);
      preview.appendChild(box);
    }
    reader.readAsDataURL(file);
  });
});

async function createPDF(){

  if(imageFiles.length===0) return alert("Upload images first");

  const { PDFDocument } = PDFLib;
  const pdfDoc=await PDFDocument.create();
  const pageSize=document.getElementById("pageSize").value;
  const margin=parseInt(document.getElementById("margin").value)||0;

  for(let file of imageFiles){

    const bytes=await file.arrayBuffer();
    let img;

    if(file.type.includes("png"))
      img=await pdfDoc.embedPng(bytes);
    else
      img=await pdfDoc.embedJpg(bytes);

    let page;
    if(pageSize==="A4"){
      page=pdfDoc.addPage([595,842]);
    }else{
      page=pdfDoc.addPage([img.width+margin*2,img.height+margin*2]);
    }

    const { width,height }=page.getSize();
    page.drawImage(img,{
      x:margin,
      y:margin,
      width:width-margin*2,
      height:height-margin*2
    });
  }

  const pdfBytes=await pdfDoc.save();
  downloadFile(pdfBytes,"images.pdf","application/pdf");
}

/* ================= PDF → IMAGE ================= */

let renderedImages=[];

document.getElementById('pdfInput').addEventListener('change',async function(e){

  const file=e.target.files[0];
  if(!file) return;

  renderedImages=[];
  document.getElementById("pdfPreview").innerHTML="";

  const bytes=await file.arrayBuffer();
  const pdf=await pdfjsLib.getDocument({data:bytes}).promise;

  for(let i=1;i<=pdf.numPages;i++){
    const page=await pdf.getPage(i);
    const viewport=page.getViewport({scale:1.5});

    const canvas=document.createElement("canvas");
    const ctx=canvas.getContext("2d");
    canvas.width=viewport.width;
    canvas.height=viewport.height;

    await page.render({canvasContext:ctx,viewport}).promise;

    renderedImages.push(canvas);

    const box=document.createElement("div");
    box.className="preview-box";
    box.appendChild(canvas);
    document.getElementById("pdfPreview").appendChild(box);
  }
});

function downloadAllImages(){

  if(renderedImages.length===0) return alert("Upload PDF first");

  const format=document.getElementById("imgFormat").value;
  const quality=parseFloat(document.getElementById("imgQuality").value);
  const ext=format.split("/")[1];

  renderedImages.forEach((canvas,i)=>{
    canvas.toBlob(function(blob){
      const link=document.createElement("a");
      link.href=URL.createObjectURL(blob);
      link.download=`page-${i+1}.${ext}`;
      link.click();
    },format,quality);
  });
}

/* ================= DOWNLOAD ================= */

function downloadFile(bytes,filename,type){
  const blob=new Blob([bytes],{type:type});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download=filename;
  link.click();
}

</script>
</body>
</html>
