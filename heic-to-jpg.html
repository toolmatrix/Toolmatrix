<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HEIC to JPG Converter</title>
<script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
  background:#f5f7fa;color:#333;min-height:100vh;
  display:flex;flex-direction:column
}

/* NAV */
nav{
  background:#fff;padding:14px 24px;display:flex;align-items:center;
  border-bottom:1px solid #e8ecf0;
  box-shadow:0 1px 3px rgba(0,0,0,.04)
}
.nav-logo{
  width:36px;height:36px;background:linear-gradient(135deg,#1d9c73,#27ae60);
  border-radius:10px;display:flex;align-items:center;justify-content:center;
  color:#fff;font-weight:900;font-size:.9rem;margin-right:10px
}
.nav-title{font-weight:700;font-size:1.1rem;color:#1d9c73}
.nav-sub{color:#aaa;font-size:.78rem;margin-left:8px;font-weight:500}

/* HERO */
.hero{
  text-align:center;padding:50px 20px 30px;
  background:linear-gradient(180deg,#f0faf5 0%,#f5f7fa 100%)
}
.hero h1{font-size:2rem;font-weight:800;color:#222;margin-bottom:8px}
.hero h1 span{color:#1d9c73}
.hero p{color:#888;font-size:1rem;max-width:500px;margin:0 auto}

/* UPLOAD AREA */
.upload-section{
  display:flex;justify-content:center;padding:10px 20px 40px
}
#dropZone{
  width:100%;max-width:620px;padding:50px 30px;
  border:2.5px dashed #c8e6c9;border-radius:16px;
  background:#fff;text-align:center;cursor:pointer;
  transition:all .25s ease
}
#dropZone:hover,#dropZone.dragover{
  border-color:#1d9c73;background:#f7fdf9;
  transform:translateY(-2px);
  box-shadow:0 8px 25px rgba(29,156,115,.1)
}
.dz-icon{font-size:3rem;margin-bottom:12px;opacity:.6}
.dz-text{font-size:1.05rem;color:#666;margin-bottom:4px;font-weight:500}
.dz-hint{font-size:.85rem;color:#aaa;margin-bottom:18px}
.dz-btn{
  display:inline-block;padding:12px 32px;
  background:linear-gradient(135deg,#1d9c73,#27ae60);
  color:#fff;border:none;border-radius:30px;font-size:.95rem;
  font-weight:700;cursor:pointer;transition:all .2s;
  box-shadow:0 4px 14px rgba(29,156,115,.25)
}
.dz-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(29,156,115,.35)}
.dz-format{font-size:.75rem;color:#bbb;margin-top:14px}
#fileInput{display:none}

/* QUALITY BAR */
.quality-bar{
  display:none;justify-content:center;padding:0 20px 20px
}
.quality-bar.show{display:flex}
.quality-box{
  background:#fff;border-radius:12px;padding:16px 24px;
  width:100%;max-width:620px;display:flex;align-items:center;
  gap:14px;border:1px solid #e8ecf0
}
.quality-box label{font-size:.85rem;font-weight:600;color:#555;white-space:nowrap}
.quality-box input[type="range"]{
  flex:1;-webkit-appearance:none;height:5px;border-radius:3px;
  background:#e0e0e0;outline:none;cursor:pointer
}
.quality-box input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;width:18px;height:18px;border-radius:50%;
  background:#1d9c73;cursor:pointer;border:3px solid #fff;
  box-shadow:0 1px 4px rgba(0,0,0,.2)
}
.quality-box .qval{
  font-size:.85rem;font-weight:700;color:#1d9c73;min-width:36px;text-align:right
}

/* FILE LIST */
.files-section{
  display:none;justify-content:center;padding:0 20px 30px
}
.files-section.show{display:flex}
.files-box{width:100%;max-width:620px}
.files-header{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:12px
}
.files-header h3{font-size:1rem;font-weight:700;color:#333}
.file-count{font-size:.8rem;color:#999;font-weight:500}
.clear-btn{
  padding:6px 16px;border:1.5px solid #e0e0e0;border-radius:8px;
  background:#fff;color:#888;font-size:.8rem;font-weight:600;
  cursor:pointer;transition:all .15s
}
.clear-btn:hover{border-color:#e74c3c;color:#e74c3c;background:#fdf2f2}

.file-list{display:flex;flex-direction:column;gap:8px}
.file-item{
  display:flex;align-items:center;gap:12px;padding:14px 16px;
  background:#fff;border-radius:12px;border:1px solid #eef0f3;
  transition:all .2s
}
.file-item:hover{box-shadow:0 2px 10px rgba(0,0,0,.04)}
.file-thumb{
  width:48px;height:48px;border-radius:8px;background:#f0f2f5;
  display:flex;align-items:center;justify-content:center;
  font-size:1.3rem;overflow:hidden;flex-shrink:0
}
.file-thumb img{width:100%;height:100%;object-fit:cover;border-radius:8px}
.file-info{flex:1;min-width:0}
.file-name{font-size:.88rem;font-weight:600;color:#333;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.file-size{font-size:.75rem;color:#aaa;margin-top:2px}
.file-status{flex-shrink:0;display:flex;align-items:center;gap:6px}

/* Status badges */
.badge{
  padding:5px 12px;border-radius:20px;font-size:.75rem;font-weight:600;
  display:inline-flex;align-items:center;gap:4px
}
.badge.waiting{background:#f0f2f5;color:#999}
.badge.converting{background:#fff8e1;color:#f39c12}
.badge.done{background:#e8f8f0;color:#1d9c73}
.badge.error{background:#fde8e8;color:#e74c3c}

/* Spinner */
.mini-spin{
  width:14px;height:14px;border:2px solid #f0d78c;
  border-top-color:#f39c12;border-radius:50%;
  animation:spin .6s linear infinite;display:inline-block
}
@keyframes spin{to{transform:rotate(360deg)}}

/* Download button per file */
.dl-btn{
  padding:6px 14px;border:none;border-radius:8px;
  background:#1d9c73;color:#fff;font-size:.78rem;font-weight:600;
  cursor:pointer;transition:all .15s;white-space:nowrap
}
.dl-btn:hover{background:#27ae60}

/* CONVERT / DOWNLOAD ALL */
.action-section{
  display:none;justify-content:center;padding:0 20px 40px;gap:10px;flex-wrap:wrap
}
.action-section.show{display:flex}
.act-btn{
  padding:14px 36px;border:none;border-radius:12px;font-size:1rem;
  font-weight:700;cursor:pointer;transition:all .2s;display:inline-flex;
  align-items:center;gap:8px
}
.act-btn.convert{
  background:linear-gradient(135deg,#1d9c73,#27ae60);color:#fff;
  box-shadow:0 4px 16px rgba(29,156,115,.25)
}
.act-btn.convert:hover{transform:translateY(-2px);box-shadow:0 6px 22px rgba(29,156,115,.35)}
.act-btn.convert:disabled{opacity:.5;cursor:default;transform:none}
.act-btn.download-all{
  background:#fff;color:#1d9c73;border:2px solid #1d9c73
}
.act-btn.download-all:hover{background:#f0faf5}
.act-btn .btn-spin{
  width:18px;height:18px;border:2.5px solid rgba(255,255,255,.3);
  border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite
}
.add-more{
  padding:14px 28px;border:2px dashed #ccc;border-radius:12px;
  background:#fff;color:#999;font-size:.9rem;font-weight:600;
  cursor:pointer;transition:all .15s
}
.add-more:hover{border-color:#1d9c73;color:#1d9c73;background:#f7fdf9}

/* PROGRESS */
.progress-bar{
  display:none;justify-content:center;padding:0 20px 20px
}
.progress-bar.show{display:flex}
.progress-box{
  width:100%;max-width:620px;background:#fff;border-radius:12px;
  padding:16px 20px;border:1px solid #e8ecf0
}
.prog-label{font-size:.82rem;color:#888;margin-bottom:8px;font-weight:500}
.prog-track{
  width:100%;height:8px;background:#e8ecf0;border-radius:4px;overflow:hidden
}
.prog-fill{
  height:100%;background:linear-gradient(90deg,#1d9c73,#27ae60);
  border-radius:4px;transition:width .3s ease;width:0
}
.prog-text{font-size:.78rem;color:#1d9c73;margin-top:6px;font-weight:600;text-align:right}

/* FOOTER */
footer{
  margin-top:auto;text-align:center;padding:20px;
  color:#bbb;font-size:.78rem;border-top:1px solid #eef0f3
}
footer span{color:#1d9c73;font-weight:600}

/* TOAST */
.toast{
  position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);
  background:#fff;color:#333;padding:12px 24px;border-radius:10px;
  font-size:.88rem;font-weight:500;box-shadow:0 4px 20px rgba(0,0,0,.1);
  z-index:300;transition:transform .3s ease;
  border-left:4px solid #1d9c73
}
.toast.err{border-left-color:#e74c3c}
.toast.show{transform:translateX(-50%) translateY(0)}

/* RESPONSIVE */
@media(max-width:600px){
  .hero{padding:30px 16px 20px}
  .hero h1{font-size:1.5rem}
  .hero p{font-size:.88rem}
  #dropZone{padding:35px 20px}
  .dz-icon{font-size:2.5rem}
  .file-item{padding:10px 12px;gap:10px}
  .file-thumb{width:40px;height:40px}
  .quality-box{flex-wrap:wrap;gap:8px}
  .act-btn{padding:12px 24px;font-size:.9rem}
  .nav-sub{display:none}
}
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-logo">HC</div>
  <span class="nav-title">HEIC to JPG</span>
  <span class="nav-sub">Free Online Converter</span>
</nav>

<!-- HERO -->
<div class="hero">
  <h1>Convert <span>HEIC</span> to <span>JPG</span></h1>
  <p>Transform Apple HEIC photos to JPG format instantly. Free, fast, and works right in your browser.</p>
</div>

<!-- UPLOAD -->
<div class="upload-section">
  <div id="dropZone">
    <div class="dz-icon">üìÅ</div>
    <div class="dz-text">Drag & drop HEIC files here</div>
    <div class="dz-hint">or</div>
    <button class="dz-btn" onclick="document.getElementById('fileInput').click()">Select HEIC Files</button>
    <div class="dz-format">Supports: .heic, .heif</div>
  </div>
  <input type="file" id="fileInput" accept=".heic,.heif,image/heic,image/heif" multiple>
</div>

<!-- QUALITY -->
<div class="quality-bar" id="qualityBar">
  <div class="quality-box">
    <label>JPG Quality:</label>
    <input type="range" min="10" max="100" value="92" id="qualitySlider" oninput="document.getElementById('qVal').textContent=this.value+'%'">
    <span class="qval" id="qVal">92%</span>
  </div>
</div>

<!-- PROGRESS -->
<div class="progress-bar" id="progressBar">
  <div class="progress-box">
    <div class="prog-label" id="progLabel">Converting...</div>
    <div class="prog-track"><div class="prog-fill" id="progFill"></div></div>
    <div class="prog-text" id="progText">0%</div>
  </div>
</div>

<!-- FILE LIST -->
<div class="files-section" id="filesSection">
  <div class="files-box">
    <div class="files-header">
      <div>
        <h3>Files</h3>
        <span class="file-count" id="fileCount">0 files selected</span>
      </div>
      <button class="clear-btn" onclick="clearAll()">‚úï Clear All</button>
    </div>
    <div class="file-list" id="fileList"></div>
  </div>
</div>

<!-- ACTIONS -->
<div class="action-section" id="actionSection">
  <button class="add-more" onclick="document.getElementById('fileInput').click()">+ Add More</button>
  <button class="act-btn convert" id="convertBtn" onclick="convertAll()">
    Convert to JPG
  </button>
  <button class="act-btn download-all" id="downloadAllBtn" onclick="downloadAll()" style="display:none">
    ‚§ì Download All
  </button>
</div>

<!-- FOOTER -->
<footer>
  <span>HEIC to JPG</span> ‚Äî Your files never leave your browser. 100% private & secure.
</footer>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
let files = [];
let convertedBlobs = [];
let isConverting = false;

// Init
document.addEventListener('DOMContentLoaded', () => {
  const dz = document.getElementById('dropZone');
  const fi = document.getElementById('fileInput');

  // Click
  dz.addEventListener('click', e => {
    if (e.target.tagName !== 'BUTTON') fi.click();
  });

  // Drag
  ['dragenter','dragover'].forEach(ev => 
    dz.addEventListener(ev, e => { e.preventDefault(); dz.classList.add('dragover'); })
  );
  ['dragleave','drop'].forEach(ev => 
    dz.addEventListener(ev, e => { e.preventDefault(); dz.classList.remove('dragover'); })
  );
  dz.addEventListener('drop', e => {
    const dt = e.dataTransfer.files;
    handleFiles(dt);
  });

  // File input
  fi.addEventListener('change', e => {
    handleFiles(e.target.files);
    fi.value = '';
  });
});

function handleFiles(fileList) {
  let added = 0;
  for (let f of fileList) {
    const name = f.name.toLowerCase();
    if (name.endsWith('.heic') || name.endsWith('.heif') || 
        f.type === 'image/heic' || f.type === 'image/heif') {
      files.push({
        file: f,
        name: f.name,
        size: f.size,
        status: 'waiting', // waiting, converting, done, error
        blob: null,
        url: null
      });
      added++;
    }
  }

  if (added === 0 && fileList.length > 0) {
    showToast('Please select HEIC/HEIF files only', true);
    return;
  }

  if (added > 0) {
    showToast(`${added} file${added > 1 ? 's' : ''} added`);
    renderFiles();
    showSections();
  }
}

function renderFiles() {
  const list = document.getElementById('fileList');
  list.innerHTML = '';
  document.getElementById('fileCount').textContent = files.length + ' file' + (files.length !== 1 ? 's' : '') + ' selected';

  files.forEach((f, i) => {
    const item = document.createElement('div');
    item.className = 'file-item';
    item.id = 'file-' + i;

    let thumbHTML = '';
    if (f.url) {
      thumbHTML = `<img src="${f.url}" alt="">`;
    } else {
      thumbHTML = 'üñºÔ∏è';
    }

    let statusHTML = '';
    if (f.status === 'waiting') {
      statusHTML = `<span class="badge waiting">Waiting</span>`;
    } else if (f.status === 'converting') {
      statusHTML = `<span class="badge converting"><span class="mini-spin"></span> Converting</span>`;
    } else if (f.status === 'done') {
      statusHTML = `
        <span class="badge done">‚úì Done</span>
        <button class="dl-btn" onclick="downloadOne(${i})">‚§ì JPG</button>
      `;
    } else if (f.status === 'error') {
      statusHTML = `<span class="badge error">‚úï Error</span>`;
    }

    const sizeStr = formatSize(f.status === 'done' && f.blob ? f.blob.size : f.size);

    item.innerHTML = `
      <div class="file-thumb">${thumbHTML}</div>
      <div class="file-info">
        <div class="file-name">${escHTML(f.name.replace(/\.heic$/i, '.jpg').replace(/\.heif$/i, '.jpg'))}</div>
        <div class="file-size">${sizeStr}</div>
      </div>
      <div class="file-status">${statusHTML}</div>
    `;
    list.appendChild(item);
  });
}

function showSections() {
  document.getElementById('filesSection').classList.add('show');
  document.getElementById('actionSection').classList.add('show');
  document.getElementById('qualityBar').classList.add('show');

  const allDone = files.length > 0 && files.every(f => f.status === 'done');
  document.getElementById('downloadAllBtn').style.display = allDone ? 'inline-flex' : 'none';
  document.getElementById('convertBtn').style.display = allDone ? 'none' : 'inline-flex';
}

async function convertAll() {
  if (isConverting || files.length === 0) return;
  isConverting = true;

  const btn = document.getElementById('convertBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="btn-spin"></span> Converting...';

  const progBar = document.getElementById('progressBar');
  progBar.classList.add('show');

  const quality = parseInt(document.getElementById('qualitySlider').value) / 100;
  let done = 0;

  for (let i = 0; i < files.length; i++) {
    if (files[i].status === 'done') {
      done++;
      continue;
    }

    files[i].status = 'converting';
    renderFiles();

    try {
      const blob = await heic2any({
        blob: files[i].file,
        toType: 'image/jpeg',
        quality: quality
      });

      const resultBlob = Array.isArray(blob) ? blob[0] : blob;
      files[i].blob = resultBlob;
      files[i].url = URL.createObjectURL(resultBlob);
      files[i].status = 'done';
    } catch (err) {
      console.error('Convert error:', err);
      files[i].status = 'error';
    }

    done++;
    const pct = Math.round((done / files.length) * 100);
    document.getElementById('progFill').style.width = pct + '%';
    document.getElementById('progText').textContent = pct + '%';
    document.getElementById('progLabel').textContent = `Converting... (${done}/${files.length})`;

    renderFiles();
  }

  document.getElementById('progLabel').textContent = 'Conversion complete!';
  isConverting = false;
  btn.disabled = false;
  btn.innerHTML = 'Convert to JPG';

  const allDone = files.every(f => f.status === 'done');
  const anyDone = files.some(f => f.status === 'done');

  if (allDone) {
    showToast('‚úì All files converted successfully!');
    document.getElementById('downloadAllBtn').style.display = 'inline-flex';
    document.getElementById('convertBtn').style.display = 'none';
  } else if (anyDone) {
    showToast('Some files converted. Check errors.');
    document.getElementById('downloadAllBtn').style.display = 'inline-flex';
  } else {
    showToast('Conversion failed. Try different files.', true);
  }

  setTimeout(() => {
    progBar.classList.remove('show');
  }, 2000);
}

function downloadOne(idx) {
  const f = files[idx];
  if (!f.blob) return;
  const a = document.createElement('a');
  a.href = f.url || URL.createObjectURL(f.blob);
  a.download = f.name.replace(/\.heic$/i, '.jpg').replace(/\.heif$/i, '.jpg');
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

function downloadAll() {
  const doneFiles = files.filter(f => f.status === 'done');
  if (doneFiles.length === 0) return;

  if (doneFiles.length === 1) {
    downloadOne(files.indexOf(doneFiles[0]));
    return;
  }

  // Download each with small delay
  doneFiles.forEach((f, i) => {
    setTimeout(() => {
      downloadOne(files.indexOf(f));
    }, i * 400);
  });

  showToast(`‚§ì Downloading ${doneFiles.length} files...`);
}

function clearAll() {
  // Revoke URLs
  files.forEach(f => { if (f.url) URL.revokeObjectURL(f.url); });
  files = [];
  renderFiles();
  document.getElementById('filesSection').classList.remove('show');
  document.getElementById('actionSection').classList.remove('show');
  document.getElementById('qualityBar').classList.remove('show');
  document.getElementById('progressBar').classList.remove('show');
  showToast('All files cleared');
}

// Utils
function formatSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / 1048576).toFixed(1) + ' MB';
}

function escHTML(s) {
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

function showToast(msg, isErr) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast' + (isErr ? ' err' : '');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}
</script>
</body>
</html>
