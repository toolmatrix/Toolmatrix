<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Watermark Remover Tool</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<style>
body{
  font-family:Arial;
  margin:0;
  background:#eef4ff;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}
h1{
  text-align:center;
  color:#007bff;
}
.section{
  background:white;
  padding:20px;
  border-radius:12px;
  margin-top:20px;
  box-shadow:0 0 15px rgba(0,0,0,0.08);
}
.preview-grid{
  display:flex;
  gap:20px;
  flex-wrap:wrap;
}
.preview-box{
  flex:1;
  min-width:300px;
}
canvas{
  width:100%;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  background:#007bff;
  color:white;
  border:none;
  padding:10px 15px;
  margin-top:10px;
  border-radius:6px;
  cursor:pointer;
}
button:hover{background:#0056b3;}
select,input{
  margin-top:10px;
}
</style>
</head>
<body>

<div class="container">
<h1>PDF Watermark Remover Tool</h1>

<div class="section">
<input type="file" id="pdfInput" accept="application/pdf">

<select id="position">
<option value="top">Top</option>
<option value="center">Center</option>
<option value="bottom">Bottom</option>
</select>

<input type="number" id="boxHeight" placeholder="Watermark Area Height (px)" value="100">

<button onclick="removeWatermark()">Remove Watermark</button>

<div class="preview-grid">
<div class="preview-box">
<h3>Original Preview</h3>
<div id="originalPreview"></div>
</div>

<div class="preview-box">
<h3>Watermark Removed Preview</h3>
<div id="cleanPreview"></div>
</div>
</div>

<button onclick="downloadCleanPDF()">Download Clean PDF</button>

</div>
</div>

<script>

const pdfjsLib = window['pdfjs-dist/build/pdf'];
pdfjsLib.GlobalWorkerOptions.workerSrc =
'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

let originalBytes=null;
let cleanPdfBytes=null;

document.getElementById('pdfInput').addEventListener('change',async function(e){

  const file=e.target.files[0];
  if(!file) return;

  originalBytes=await file.arrayBuffer();
  document.getElementById("originalPreview").innerHTML="";
  document.getElementById("cleanPreview").innerHTML="";

  renderPDF(originalBytes,"originalPreview");
});

async function renderPDF(bytes,containerId){

  const pdf=await pdfjsLib.getDocument({data:bytes}).promise;
  const container=document.getElementById(containerId);

  for(let i=1;i<=pdf.numPages;i++){
    const page=await pdf.getPage(i);
    const viewport=page.getViewport({scale:1});
    const canvas=document.createElement("canvas");
    const ctx=canvas.getContext("2d");
    canvas.width=viewport.width;
    canvas.height=viewport.height;

    await page.render({canvasContext:ctx,viewport}).promise;
    container.appendChild(canvas);
  }
}

async function removeWatermark(){

  if(!originalBytes) return alert("Upload PDF first");

  const { PDFDocument, rgb } = PDFLib;
  const pdfDoc=await PDFDocument.load(originalBytes);
  const pages=pdfDoc.getPages();

  const position=document.getElementById("position").value;
  const boxHeight=parseInt(document.getElementById("boxHeight").value)||100;

  pages.forEach(page=>{
    const { width,height }=page.getSize();
    let yPos=0;

    if(position==="top") yPos=height-boxHeight;
    if(position==="center") yPos=(height/2)-(boxHeight/2);
    if(position==="bottom") yPos=0;

    page.drawRectangle({
      x:0,
      y:yPos,
      width:width,
      height:boxHeight,
      color:rgb(1,1,1)
    });
  });

  cleanPdfBytes=await pdfDoc.save();
  document.getElementById("cleanPreview").innerHTML="";
  renderPDF(cleanPdfBytes,"cleanPreview");
}

function downloadCleanPDF(){
  if(!cleanPdfBytes) return alert("Remove watermark first");

  const blob=new Blob([cleanPdfBytes],{type:"application/pdf"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download="cleaned.pdf";
  link.click();
}

</script>
</body>
</html>
