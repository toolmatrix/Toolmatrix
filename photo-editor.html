<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free Online Photo Editor - Edit photos online with crop, resize, filters, adjustments, text, drawing tools. No signup required. Professional image editing in your browser!">
    <meta name="keywords" content="photo editor, online photo editor, image editor, free photo editor, edit photos online, crop image, resize image, photo filters, image editing tool, picture editor, photo editing software free, edit pictures online free">
    <meta name="author" content="Photo Editor Pro">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1">
    <meta property="og:title" content="Free Online Photo Editor - Edit Photos Instantly | Professional Tool">
    <meta property="og:description" content="Edit photos online free with crop, resize, 20+ filters, brightness, contrast, text overlay, drawing & more. No signup required!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/photo-editor">
    <meta property="og:image" content="https://yourdomain.com/photo-editor-preview.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Free Online Photo Editor - Professional Image Editing Tool">
    <meta name="twitter:description" content="Edit photos online with 20+ filters, crop, resize, text, drawing & more. 100% free, no signup!">
    <link rel="canonical" href="https://yourdomain.com/photo-editor">
    <title>Free Online Photo Editor - Edit Photos, Crop, Resize, Filters | Professional Tool</title>

    <!-- Schema Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Photo Editor Pro - Free Online Photo Editor",
        "description": "Professional online photo editor with crop, resize, filters, adjustments, text overlay and drawing tools. Edit photos directly in your browser for free.",
        "url": "https://yourdomain.com/photo-editor",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "All",
        "browserRequirements": "Requires JavaScript. Requires HTML5 Canvas.",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": "Photo Editing, Image Filters, Crop Tool, Resize Tool, Text Overlay, Drawing Tool, Brightness Adjustment, Contrast Adjustment, Saturation Control"
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "How to edit photos online for free?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Upload your photo to our free online photo editor, use tools like crop, resize, filters, brightness, contrast and text overlay to edit your image, then download the edited photo instantly. No signup or payment required."
                }
            },
            {
                "@type": "Question",
                "name": "What formats does the photo editor support?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Our photo editor supports all common image formats including JPG, JPEG, PNG, WebP, BMP, GIF and SVG. You can export your edited photos in PNG or JPEG format."
                }
            },
            {
                "@type": "Question",
                "name": "Is this photo editor really free?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes, this photo editor is 100% free with no hidden charges. All features including filters, crop, resize, text and drawing tools are available at no cost. No signup or account creation needed."
                }
            }
        ]
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://yourdomain.com"},
            {"@type": "ListItem", "position": 2, "name": "Photo Editor", "item": "https://yourdomain.com/photo-editor"}
        ]
    }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --secondary: #06b6d4;
            --accent: #f43f5e;
            --success: #10b981;
            --warning: #f59e0b;
            --bg-main: #09090b;
            --bg-surface: #18181b;
            --bg-elevated: #27272a;
            --bg-hover: #3f3f46;
            --border: #3f3f46;
            --border-light: #52525b;
            --text: #fafafa;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 16px;
            --shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            --transition: all 0.2s ease;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-main);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* ===== HEADER / NAVBAR ===== */
        .navbar {
            background: rgba(24,24,27,0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--text);
        }

        .nav-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .nav-title {
            font-size: 1.2rem;
            font-weight: 800;
        }

        .nav-title span {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            border-color: var(--border-light);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--accent);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* ===== EDITOR LAYOUT ===== */
        .editor-layout {
            display: grid;
            grid-template-columns: 72px 280px 1fr 300px;
            height: calc(100vh - 64px);
            overflow: hidden;
        }

        /* ===== LEFT TOOLBAR ===== */
        .toolbar {
            background: var(--bg-surface);
            border-right: 1px solid var(--border);
            padding: 12px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            overflow-y: auto;
        }

        .tool-btn {
            width: 48px;
            height: 48px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
            font-size: 16px;
            transition: var(--transition);
            position: relative;
        }

        .tool-btn span {
            font-size: 0.55rem;
            font-weight: 500;
        }

        .tool-btn:hover {
            background: var(--bg-elevated);
            color: var(--text);
        }

        .tool-btn.active {
            background: var(--primary);
            color: white;
        }

        .tool-divider {
            width: 32px;
            height: 1px;
            background: var(--border);
            margin: 6px 0;
        }

        /* ===== LEFT PANEL ===== */
        .left-panel {
            background: var(--bg-surface);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            padding: 16px;
        }

        .panel-section {
            display: none;
        }

        .panel-section.active {
            display: block;
        }

        .panel-title {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title i {
            color: var(--primary);
        }

        /* Slider Controls */
        .control-group {
            margin-bottom: 18px;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .control-label span {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .control-label .value {
            font-size: 0.75rem;
            background: var(--bg-elevated);
            padding: 2px 8px;
            border-radius: 4px;
            color: var(--primary);
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: var(--bg-elevated);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(99,102,241,0.4);
            transition: var(--transition);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(99,102,241,0.6);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* Filter Grid */
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .filter-item {
            background: var(--bg-elevated);
            border: 2px solid transparent;
            border-radius: var(--radius-sm);
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .filter-item:hover {
            border-color: var(--border-light);
            color: var(--text);
        }

        .filter-item.active {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(99,102,241,0.1);
        }

        .filter-item .filter-preview {
            width: 100%;
            height: 40px;
            border-radius: 4px;
            margin-bottom: 6px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        /* Color Picker */
        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .color-picker-wrapper input[type="color"] {
            -webkit-appearance: none;
            width: 40px;
            height: 40px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            background: none;
            padding: 2px;
        }

        .color-picker-wrapper input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .color-picker-wrapper input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 4px;
        }

        /* Small input */
        .small-input {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text);
            font-family: inherit;
            font-size: 0.85rem;
            outline: none;
            transition: var(--transition);
        }

        .small-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99,102,241,0.1);
        }

        .small-select {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text);
            font-family: inherit;
            font-size: 0.85rem;
            outline: none;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23a1a1aa' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        .btn-panel {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--bg-elevated);
            color: var(--text);
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 8px;
        }

        .btn-panel:hover {
            background: var(--bg-hover);
        }

        .btn-panel.primary {
            background: var(--primary);
            border-color: var(--primary);
        }

        .btn-panel.primary:hover {
            background: var(--primary-hover);
        }

        .row-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        /* ===== CANVAS AREA ===== */
        .canvas-area {
            background: #0c0c0e;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background-image:
                linear-gradient(45deg, #1a1a1e 25%, transparent 25%),
                linear-gradient(-45deg, #1a1a1e 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #1a1a1e 75%),
                linear-gradient(-45deg, transparent 75%, #1a1a1e 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0;
        }

        .canvas-wrapper {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }

        #mainCanvas {
            max-width: 100%;
            max-height: calc(100vh - 130px);
            border-radius: 4px;
            box-shadow: var(--shadow);
            cursor: crosshair;
        }

        /* Upload Placeholder */
        .upload-placeholder {
            text-align: center;
            padding: 60px;
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: var(--radius-lg);
            padding: 60px 40px;
            cursor: pointer;
            transition: var(--transition);
            background: rgba(24,24,27,0.5);
            max-width: 500px;
            margin: 0 auto;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(99,102,241,0.05);
        }

        .upload-area.dragover {
            border-color: var(--primary);
            background: rgba(99,102,241,0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            width: 80px;
            height: 80px;
            background: rgba(99,102,241,0.1);
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .upload-area h3 {
            font-size: 1.3rem;
            margin-bottom: 8px;
        }

        .upload-area p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .upload-area .formats {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 12px;
        }

        #fileInput {
            display: none;
        }

        /* ===== RIGHT PANEL ===== */
        .right-panel {
            background: var(--bg-surface);
            border-left: 1px solid var(--border);
            overflow-y: auto;
            padding: 16px;
        }

        .info-card {
            background: var(--bg-elevated);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
        }

        .info-card h4 {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 0.82rem;
        }

        .info-row .label {
            color: var(--text-secondary);
        }

        .info-row .val {
            color: var(--text);
            font-weight: 600;
        }

        /* History */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-elevated);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .history-item:hover {
            background: var(--bg-hover);
        }

        .history-item i {
            color: var(--primary);
            width: 20px;
            text-align: center;
        }

        /* Zoom Bar */
        .zoom-bar {
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(24,24,27,0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 8px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10;
        }

        .zoom-bar button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
            transition: var(--transition);
        }

        .zoom-bar button:hover {
            color: var(--text);
        }

        .zoom-bar span {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text);
            min-width: 40px;
            text-align: center;
        }

        /* Export Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 32px;
            max-width: 450px;
            width: 90%;
            box-shadow: var(--shadow);
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal h3 i {
            color: var(--primary);
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 18px;
            cursor: pointer;
        }

        .export-formats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .export-format {
            padding: 16px 10px;
            background: var(--bg-elevated);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.85rem;
        }

        .export-format:hover {
            border-color: var(--border-light);
        }

        .export-format.active {
            border-color: var(--primary);
            background: rgba(99,102,241,0.1);
            color: var(--primary);
        }

        .export-format .format-icon {
            font-size: 1.5rem;
            margin-bottom: 6px;
            display: block;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 3000;
            box-shadow: var(--shadow);
            transform: translateX(120%);
            transition: transform 0.4s ease;
            font-size: 0.9rem;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast i {
            font-size: 1.2rem;
        }

        .toast.success i { color: var(--success); }
        .toast.error i { color: var(--accent); }

        /* Crop overlay */
        .crop-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 5;
        }

        .crop-overlay.active {
            display: block;
        }

        /* ===== SEO CONTENT (below editor) ===== */
        .seo-wrapper {
            max-width: 1000px;
            margin: 0 auto;
            padding: 60px 24px;
        }

        .seo-section {
            margin-bottom: 50px;
        }

        .seo-section h2 {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .seo-section h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 24px 0 10px;
            color: var(--secondary);
        }

        .seo-section p {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 14px;
            font-size: 0.95rem;
        }

        .seo-section ul {
            color: var(--text-secondary);
            padding-left: 20px;
            margin-bottom: 14px;
        }

        .seo-section ul li {
            margin-bottom: 8px;
            line-height: 1.7;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-card {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 30px;
            transition: var(--transition);
        }

        .feature-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
        }

        .feature-card .fc-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-bottom: 16px;
            background: rgba(99,102,241,0.1);
            color: var(--primary);
        }

        .feature-card h3 {
            font-size: 1.05rem;
            margin-bottom: 8px;
            color: var(--text);
        }

        .feature-card p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* FAQ */
        .faq-item {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 10px;
            overflow: hidden;
        }

        .faq-q {
            padding: 18px 20px;
            background: var(--bg-surface);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .faq-q:hover {
            background: var(--bg-elevated);
        }

        .faq-q i {
            color: var(--primary);
            transition: transform 0.3s ease;
        }

        .faq-item.open .faq-q i {
            transform: rotate(180deg);
        }

        .faq-a {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .faq-a-inner {
            padding: 0 20px 18px;
            color: var(--text-secondary);
            line-height: 1.7;
            font-size: 0.9rem;
        }

        .faq-item.open .faq-a {
            max-height: 300px;
        }

        /* Footer */
        .site-footer {
            text-align: center;
            padding: 40px 24px;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .editor-layout {
                grid-template-columns: 60px 1fr;
                grid-template-rows: 1fr;
            }
            .left-panel, .right-panel {
                display: none;
            }
            .left-panel.mobile-show, .right-panel.mobile-show {
                display: block;
                position: fixed;
                top: 64px;
                left: 0;
                width: 300px;
                height: calc(100vh - 64px);
                z-index: 500;
                box-shadow: var(--shadow);
            }
            .right-panel.mobile-show {
                left: auto;
                right: 0;
            }
        }

        @media (max-width: 768px) {
            .editor-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            .toolbar {
                flex-direction: row;
                overflow-x: auto;
                border-right: none;
                border-bottom: 1px solid var(--border);
                padding: 8px;
            }
            .tool-divider {
                width: 1px;
                height: 32px;
                margin: 0 4px;
            }
            .tool-btn {
                width: 44px;
                height: 44px;
                flex-shrink: 0;
            }
            .tool-btn span {
                display: none;
            }
            .nav-title { display: none; }
            .nav-btn span { display: none; }
            .features-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .upload-area { padding: 30px 20px; }
            .upload-icon { width: 60px; height: 60px; font-size: 24px; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--border-light); }
    </style>
</head>
<body>

    <!-- Navigation -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <a href="#" class="nav-brand">
            <div class="nav-logo"><i class="fas fa-wand-magic-sparkles"></i></div>
            <div class="nav-title"><span>Photo Editor</span> Pro</div>
        </a>
        <div class="nav-actions">
            <button class="nav-btn btn-secondary" onclick="document.getElementById('fileInput').click()" title="Open Image">
                <i class="fas fa-folder-open"></i> <span>Open</span>
            </button>
            <button class="nav-btn btn-secondary" onclick="undoAction()" title="Undo" id="undoBtn" disabled>
                <i class="fas fa-undo"></i>
            </button>
            <button class="nav-btn btn-secondary" onclick="redoAction()" title="Redo" id="redoBtn" disabled>
                <i class="fas fa-redo"></i>
            </button>
            <button class="nav-btn btn-secondary" onclick="resetAll()" title="Reset All">
                <i class="fas fa-rotate-left"></i> <span>Reset</span>
            </button>
            <button class="nav-btn btn-success" onclick="openExportModal()" title="Download Image">
                <i class="fas fa-download"></i> <span>Export</span>
            </button>
        </div>
    </nav>

    <input type="file" id="fileInput" accept="image/*" onchange="loadImage(event)" aria-label="Upload image file">

    <!-- Editor Layout -->
    <div class="editor-layout" id="editorLayout">

        <!-- Left Toolbar -->
        <div class="toolbar" role="toolbar" aria-label="Editing tools">
            <button class="tool-btn active" data-tool="adjust" onclick="switchTool('adjust')" title="Adjustments">
                <i class="fas fa-sliders-h"></i><span>Adjust</span>
            </button>
            <button class="tool-btn" data-tool="filters" onclick="switchTool('filters')" title="Filters">
                <i class="fas fa-palette"></i><span>Filters</span>
            </button>
            <div class="tool-divider"></div>
            <button class="tool-btn" data-tool="crop" onclick="switchTool('crop')" title="Crop">
                <i class="fas fa-crop-alt"></i><span>Crop</span>
            </button>
            <button class="tool-btn" data-tool="resize" onclick="switchTool('resize')" title="Resize">
                <i class="fas fa-expand-arrows-alt"></i><span>Resize</span>
            </button>
            <button class="tool-btn" data-tool="rotate" onclick="switchTool('rotate')" title="Rotate & Flip">
                <i class="fas fa-sync-alt"></i><span>Rotate</span>
            </button>
            <div class="tool-divider"></div>
            <button class="tool-btn" data-tool="text" onclick="switchTool('text')" title="Add Text">
                <i class="fas fa-font"></i><span>Text</span>
            </button>
            <button class="tool-btn" data-tool="draw" onclick="switchTool('draw')" title="Draw">
                <i class="fas fa-paint-brush"></i><span>Draw</span>
            </button>
            <button class="tool-btn" data-tool="shapes" onclick="switchTool('shapes')" title="Shapes">
                <i class="fas fa-shapes"></i><span>Shapes</span>
            </button>
            <div class="tool-divider"></div>
            <button class="tool-btn" data-tool="blur" onclick="switchTool('blur')" title="Blur/Sharpen">
                <i class="fas fa-eye"></i><span>Focus</span>
            </button>
            <button class="tool-btn" data-tool="vignette" onclick="switchTool('vignette')" title="Vignette">
                <i class="fas fa-circle-notch"></i><span>Vignette</span>
            </button>
        </div>

        <!-- Left Panel -->
        <div class="left-panel" id="leftPanel">

            <!-- Adjustments Panel -->
            <div class="panel-section active" id="panel-adjust">
                <div class="panel-title"><i class="fas fa-sliders-h"></i> Adjustments</div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Brightness</span>
                        <span class="value" id="val-brightness">0</span>
                    </div>
                    <input type="range" min="-100" max="100" value="0" id="brightness" oninput="updateAdjustment(this)">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Contrast</span>
                        <span class="value" id="val-contrast">0</span>
                    </div>
                    <input type="range" min="-100" max="100" value="0" id="contrast" oninput="updateAdjustment(this)">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Saturation</span>
                        <span class="value" id="val-saturate">0</span>
                    </div>
                    <input type="range" min="-100" max="100" value="0" id="saturate" oninput="updateAdjustment(this)">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Hue Rotate</span>
                        <span class="value" id="val-hue">0°</span>
                    </div>
                    <input type="range" min="0" max="360" value="0" id="hue" oninput="updateAdjustment(this)">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Exposure</span>
                        <span class="value" id="val-exposure">0</span>
                    </div>
                    <input type="range" min="-100" max="100" value="0" id="exposure" oninput="updateAdjustment(this)">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Warmth</span>
                        <span class="value" id="val-warmth">0</span>
                    </div>
                    <input type="range" min="-100" max="100" value="0" id="warmth" oninput="updateAdjustment(this)">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Blur</span>
                        <span class="value" id="val-blurAdj">0</span>
                    </div>
                    <input type="range" min="0" max="20" value="0" id="blurAdj" oninput="updateAdjustment(this)">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Grayscale</span>
                        <span class="value" id="val-grayscale">0%</span>
                    </div>
                    <input type="range" min="0" max="100" value="0" id="grayscale" oninput="updateAdjustment(this)">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Sepia</span>
                        <span class="value" id="val-sepia">0%</span>
                    </div>
                    <input type="range" min="0" max="100" value="0" id="sepia" oninput="updateAdjustment(this)">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Invert</span>
                        <span class="value" id="val-invert">0%</span>
                    </div>
                    <input type="range" min="0" max="100" value="0" id="invert" oninput="updateAdjustment(this)">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Opacity</span>
                        <span class="value" id="val-opacity">100%</span>
                    </div>
                    <input type="range" min="0" max="100" value="100" id="opacity" oninput="updateAdjustment(this)">
                </div>

                <button class="btn-panel" onclick="resetAdjustments()"><i class="fas fa-undo"></i> Reset Adjustments</button>
            </div>

            <!-- Filters Panel -->
            <div class="panel-section" id="panel-filters">
                <div class="panel-title"><i class="fas fa-palette"></i> Filters</div>
                <div class="filter-grid" id="filterGrid"></div>
            </div>

            <!-- Crop Panel -->
            <div class="panel-section" id="panel-crop">
                <div class="panel-title"><i class="fas fa-crop-alt"></i> Crop Image</div>
                <div class="control-group">
                    <div class="control-label"><span>Aspect Ratio</span></div>
                    <select class="small-select" id="cropRatio" onchange="setCropRatio()">
                        <option value="free">Free Form</option>
                        <option value="1:1">1:1 (Square)</option>
                        <option value="4:3">4:3</option>
                        <option value="3:2">3:2</option>
                        <option value="16:9">16:9 (Widescreen)</option>
                        <option value="9:16">9:16 (Portrait)</option>
                        <option value="5:4">5:4</option>
                        <option value="2:3">2:3</option>
                    </select>
                </div>
                <div class="row-2">
                    <div class="control-group">
                        <div class="control-label"><span>X</span></div>
                        <input type="number" class="small-input" id="cropX" value="0" min="0">
                    </div>
                    <div class="control-group">
                        <div class="control-label"><span>Y</span></div>
                        <input type="number" class="small-input" id="cropY" value="0" min="0">
                    </div>
                </div>
                <div class="row-2">
                    <div class="control-group">
                        <div class="control-label"><span>Width</span></div>
                        <input type="number" class="small-input" id="cropW" value="100" min="1">
                    </div>
                    <div class="control-group">
                        <div class="control-label"><span>Height</span></div>
                        <input type="number" class="small-input" id="cropH" value="100" min="1">
                    </div>
                </div>
                <button class="btn-panel primary" onclick="applyCrop()"><i class="fas fa-check"></i> Apply Crop</button>
            </div>

            <!-- Resize Panel -->
            <div class="panel-section" id="panel-resize">
                <div class="panel-title"><i class="fas fa-expand-arrows-alt"></i> Resize Image</div>
                <div class="row-2">
                    <div class="control-group">
                        <div class="control-label"><span>Width (px)</span></div>
                        <input type="number" class="small-input" id="resizeW" min="1" oninput="lockAspect('w')">
                    </div>
                    <div class="control-group">
                        <div class="control-label"><span>Height (px)</span></div>
                        <input type="number" class="small-input" id="resizeH" min="1" oninput="lockAspect('h')">
                    </div>
                </div>
                <div class="control-group" style="margin-top:8px">
                    <label style="display:flex;align-items:center;gap:8px;font-size:0.82rem;color:var(--text-secondary);cursor:pointer">
                        <input type="checkbox" id="lockRatio" checked style="accent-color:var(--primary)"> Lock Aspect Ratio
                    </label>
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Scale %</span><span class="value" id="val-scale">100%</span></div>
                    <input type="range" min="10" max="300" value="100" id="scaleSlider" oninput="scaleImage()">
                </div>
                <button class="btn-panel primary" onclick="applyResize()"><i class="fas fa-check"></i> Apply Resize</button>
            </div>

            <!-- Rotate Panel -->
            <div class="panel-section" id="panel-rotate">
                <div class="panel-title"><i class="fas fa-sync-alt"></i> Rotate & Flip</div>
                <div class="control-group">
                    <div class="control-label"><span>Rotation</span><span class="value" id="val-rotation">0°</span></div>
                    <input type="range" min="-180" max="180" value="0" id="rotation" oninput="updateRotation()">
                </div>
                <div class="row-2" style="margin-top:12px">
                    <button class="btn-panel" onclick="rotateFixed(-90)"><i class="fas fa-undo"></i> -90°</button>
                    <button class="btn-panel" onclick="rotateFixed(90)"><i class="fas fa-redo"></i> +90°</button>
                </div>
                <div class="row-2" style="margin-top:8px">
                    <button class="btn-panel" onclick="flipImage('h')"><i class="fas fa-arrows-alt-h"></i> Flip H</button>
                    <button class="btn-panel" onclick="flipImage('v')"><i class="fas fa-arrows-alt-v"></i> Flip V</button>
                </div>
                <button class="btn-panel primary" onclick="applyRotation()" style="margin-top:12px"><i class="fas fa-check"></i> Apply</button>
            </div>

            <!-- Text Panel -->
            <div class="panel-section" id="panel-text">
                <div class="panel-title"><i class="fas fa-font"></i> Add Text</div>
                <div class="control-group">
                    <div class="control-label"><span>Text</span></div>
                    <input type="text" class="small-input" id="textInput" placeholder="Type your text here..." value="Hello World">
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Font Family</span></div>
                    <select class="small-select" id="fontFamily">
                        <option value="Inter">Inter</option>
                        <option value="Arial">Arial</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Impact">Impact</option>
                        <option value="Comic Sans MS">Comic Sans MS</option>
                    </select>
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Font Size</span><span class="value" id="val-fontSize">32</span></div>
                    <input type="range" min="8" max="200" value="32" id="fontSize" oninput="document.getElementById('val-fontSize').textContent=this.value">
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Font Weight</span></div>
                    <select class="small-select" id="fontWeight">
                        <option value="400">Normal</option>
                        <option value="600">Semi Bold</option>
                        <option value="700" selected>Bold</option>
                        <option value="900">Extra Bold</option>
                    </select>
                </div>
                <div class="color-picker-wrapper">
                    <input type="color" id="textColor" value="#ffffff">
                    <span style="font-size:0.82rem;color:var(--text-secondary)">Text Color</span>
                </div>
                <div class="color-picker-wrapper">
                    <input type="color" id="textStroke" value="#000000">
                    <span style="font-size:0.82rem;color:var(--text-secondary)">Stroke Color</span>
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Stroke Width</span><span class="value" id="val-strokeW">0</span></div>
                    <input type="range" min="0" max="10" value="0" id="strokeWidth" oninput="document.getElementById('val-strokeW').textContent=this.value">
                </div>
                <button class="btn-panel primary" onclick="addText()"><i class="fas fa-plus"></i> Add Text to Image</button>
            </div>

            <!-- Draw Panel -->
            <div class="panel-section" id="panel-draw">
                <div class="panel-title"><i class="fas fa-paint-brush"></i> Drawing Tool</div>
                <div class="color-picker-wrapper">
                    <input type="color" id="drawColor" value="#ff0000">
                    <span style="font-size:0.82rem;color:var(--text-secondary)">Brush Color</span>
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Brush Size</span><span class="value" id="val-brushSize">5</span></div>
                    <input type="range" min="1" max="50" value="5" id="brushSize" oninput="document.getElementById('val-brushSize').textContent=this.value">
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Brush Opacity</span><span class="value" id="val-brushOp">100%</span></div>
                    <input type="range" min="1" max="100" value="100" id="brushOpacity" oninput="document.getElementById('val-brushOp').textContent=this.value+'%'">
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Tool</span></div>
                    <select class="small-select" id="drawTool">
                        <option value="brush">Brush</option>
                        <option value="eraser">Eraser</option>
                    </select>
                </div>
                <button class="btn-panel" onclick="clearDrawing()"><i class="fas fa-trash"></i> Clear Drawing</button>
            </div>

            <!-- Shapes Panel -->
            <div class="panel-section" id="panel-shapes">
                <div class="panel-title"><i class="fas fa-shapes"></i> Shapes</div>
                <div class="filter-grid">
                    <div class="filter-item active" onclick="selectShape('rect', this)">▬ Rectangle</div>
                    <div class="filter-item" onclick="selectShape('circle', this)">● Circle</div>
                    <div class="filter-item" onclick="selectShape('line', this)">╲ Line</div>
                    <div class="filter-item" onclick="selectShape('arrow', this)">→ Arrow</div>
                </div>
                <div class="color-picker-wrapper" style="margin-top:12px">
                    <input type="color" id="shapeColor" value="#6366f1">
                    <span style="font-size:0.82rem;color:var(--text-secondary)">Shape Color</span>
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Border Width</span><span class="value" id="val-shapeBorder">3</span></div>
                    <input type="range" min="1" max="20" value="3" id="shapeBorder" oninput="document.getElementById('val-shapeBorder').textContent=this.value">
                </div>
                <label style="display:flex;align-items:center;gap:8px;font-size:0.82rem;color:var(--text-secondary);cursor:pointer;margin-top:8px">
                    <input type="checkbox" id="shapeFill" style="accent-color:var(--primary)"> Fill Shape
                </label>
            </div>

            <!-- Blur Panel -->
            <div class="panel-section" id="panel-blur">
                <div class="panel-title"><i class="fas fa-eye"></i> Focus / Blur</div>
                <div class="control-group">
                    <div class="control-label"><span>Blur Amount</span><span class="value" id="val-blurTool">5</span></div>
                    <input type="range" min="1" max="30" value="5" id="blurTool" oninput="document.getElementById('val-blurTool').textContent=this.value">
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Brush Size</span><span class="value" id="val-blurBrush">30</span></div>
                    <input type="range" min="10" max="100" value="30" id="blurBrush" oninput="document.getElementById('val-blurBrush').textContent=this.value">
                </div>
            </div>

            <!-- Vignette Panel -->
            <div class="panel-section" id="panel-vignette">
                <div class="panel-title"><i class="fas fa-circle-notch"></i> Vignette</div>
                <div class="control-group">
                    <div class="control-label"><span>Intensity</span><span class="value" id="val-vigIntensity">0</span></div>
                    <input type="range" min="0" max="100" value="0" id="vigIntensity" oninput="applyVignette()">
                </div>
                <div class="control-group">
                    <div class="control-label"><span>Size</span><span class="value" id="val-vigSize">50</span></div>
                    <input type="range" min="10" max="100" value="50" id="vigSize" oninput="applyVignette()">
                </div>
            </div>
        </div>

        <!-- Canvas Area -->
        <div class="canvas-area" id="canvasArea">
            <!-- Upload Placeholder -->
            <div class="upload-placeholder" id="uploadPlaceholder">
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                    <h3>Upload Your Photo</h3>
                    <p>Click to browse or drag & drop your image here</p>
                    <p class="formats">Supports: JPG, PNG, WebP, BMP, GIF, SVG</p>
                </div>
            </div>

            <!-- Canvas -->
            <div class="canvas-wrapper" id="canvasWrapper" style="display:none">
                <canvas id="mainCanvas"></canvas>
            </div>

            <!-- Zoom Bar -->
            <div class="zoom-bar" id="zoomBar" style="display:none">
                <button onclick="changeZoom(-10)"><i class="fas fa-minus"></i></button>
                <input type="range" min="10" max="300" value="100" id="zoomSlider" oninput="setZoom(this.value)" style="width:100px">
                <span id="zoomVal">100%</span>
                <button onclick="changeZoom(10)"><i class="fas fa-plus"></i></button>
                <button onclick="setZoom(100)" title="Reset Zoom"><i class="fas fa-expand"></i></button>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel" id="rightPanel">
            <div class="info-card">
                <h4>Image Info</h4>
                <div class="info-row"><span class="label">Width</span><span class="val" id="infoWidth">-</span></div>
                <div class="info-row"><span class="label">Height</span><span class="val" id="infoHeight">-</span></div>
                <div class="info-row"><span class="label">Format</span><span class="val" id="infoFormat">-</span></div>
                <div class="info-row"><span class="label">File Size</span><span class="val" id="infoSize">-</span></div>
                <div class="info-row"><span class="label">File Name</span><span class="val" id="infoName">-</span></div>
            </div>

            <div class="info-card">
                <h4>Edit History</h4>
                <div class="history-list" id="historyList">
                    <div class="history-item"><i class="fas fa-info-circle"></i> No edits yet</div>
                </div>
            </div>

            <div class="info-card">
                <h4>Quick Actions</h4>
                <button class="btn-panel" onclick="autoEnhance()" style="margin-top:0"><i class="fas fa-magic"></i> Auto Enhance</button>
                <button class="btn-panel" onclick="makeGrayscale()"><i class="fas fa-adjust"></i> Grayscale</button>
                <button class="btn-panel" onclick="makeSepia()"><i class="fas fa-image"></i> Sepia Tone</button>
                <button class="btn-panel" onclick="invertColors()"><i class="fas fa-exchange-alt"></i> Invert Colors</button>
                <button class="btn-panel" onclick="mirrorImage()"><i class="fas fa-arrows-alt-h"></i> Mirror Image</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <h3><i class="fas fa-download"></i> Export Image</h3>
            <div class="export-formats">
                <div class="export-format active" onclick="selectFormat('png', this)">
                    <span class="format-icon">🖼️</span> PNG
                </div>
                <div class="export-format" onclick="selectFormat('jpeg', this)">
                    <span class="format-icon">📷</span> JPEG
                </div>
                <div class="export-format" onclick="selectFormat('webp', this)">
                    <span class="format-icon">🌐</span> WebP
                </div>
            </div>
            <div class="control-group">
                <div class="control-label"><span>Quality</span><span class="value" id="val-quality">92%</span></div>
                <input type="range" min="10" max="100" value="92" id="exportQuality" oninput="document.getElementById('val-quality').textContent=this.value+'%'">
            </div>
            <div class="control-group">
                <div class="control-label"><span>File Name</span></div>
                <input type="text" class="small-input" id="exportName" value="edited-photo">
            </div>
            <div class="row-2" style="margin-top:16px">
                <button class="btn-panel" onclick="closeExportModal()">Cancel</button>
                <button class="btn-panel primary" onclick="exportImage()"><i class="fas fa-download"></i> Download</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"><i class="fas fa-check-circle"></i><span id="toastMsg">Saved!</span></div>

    <!-- SEO Content Below Editor -->
    <div class="seo-wrapper">
        <article class="seo-section">
            <h2>Free Online Photo Editor — Professional Image Editing Tool</h2>
            <p>Welcome to our <strong>free online photo editor</strong> — a powerful, professional-grade image editing tool that runs entirely in your browser. No downloads, no signups, no watermarks. Edit your photos with advanced tools like <strong>crop, resize, filters, brightness & contrast adjustments, text overlays, drawing tools, shapes</strong> and much more.</p>

            <h3>✨ Why Choose Our Photo Editor?</h3>
            <p>Unlike other online photo editors that require expensive subscriptions or clunky software downloads, our tool gives you professional editing capabilities completely free. All processing happens locally on your device, meaning your photos never leave your computer — <strong>100% private and secure</strong>.</p>

            <h3>🎨 Complete List of Editing Features</h3>
            <ul>
                <li><strong>Brightness, Contrast & Saturation</strong> — Fine-tune your image's exposure and color balance</li>
                <li><strong>Hue Rotation & Warmth</strong> — Change the color tone and temperature of your photos</li>
                <li><strong>20+ Professional Filters</strong> — Apply Instagram-style filters like Vintage, Cinema, Noir, Arctic and more</li>
                <li><strong>Crop Tool</strong> — Crop images with preset ratios (1:1, 4:3, 16:9) or free-form cropping</li>
                <li><strong>Resize Tool</strong> — Resize images to exact pixel dimensions with aspect ratio lock</li>
                <li><strong>Rotate & Flip</strong> — Rotate images to any angle, flip horizontally or vertically</li>
                <li><strong>Text Overlay</strong> — Add customizable text with font selection, colors, and stroke effects</li>
                <li><strong>Drawing Tool</strong> — Free-hand drawing with adjustable brush size, color and opacity</li>
                <li><strong>Shapes</strong> — Add rectangles, circles, lines and arrows to annotate your images</li>
                <li><strong>Vignette Effect</strong> — Add a professional vignette effect with adjustable intensity</li>
                <li><strong>Auto Enhance</strong> — One-click automatic image enhancement</li>
                <li><strong>Undo/Redo</strong> — Full edit history with unlimited undo and redo</li>
                <li><strong>Export Options</strong> — Download in PNG, JPEG or WebP format with quality control</li>
            </ul>

            <h3>📸 How to Edit Photos Online</h3>
            <p>Using our photo editor is simple and intuitive:</p>
            <ul>
                <li><strong>Step 1:</strong> Click "Open" or drag and drop your image into the editor</li>
                <li><strong>Step 2:</strong> Use the toolbar on the left to select your editing tool</li>
                <li><strong>Step 3:</strong> Adjust settings in the left panel — sliders, colors, text input etc.</li>
                <li><strong>Step 4:</strong> Click "Export" to download your edited image in your preferred format</li>
            </ul>

            <h3>🔒 Privacy & Security</h3>
            <p>Your privacy matters to us. This photo editor processes all images <strong>directly in your browser</strong> using HTML5 Canvas technology. No images are uploaded to any server. Your photos stay on your device at all times — completely private and secure.</p>
        </article>

        <!-- Features Grid -->
        <div class="seo-section">
            <h2>Key Features</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="fc-icon"><i class="fas fa-sliders-h"></i></div>
                    <h3>Advanced Adjustments</h3>
                    <p>Fine-tune brightness, contrast, saturation, exposure, warmth, blur, grayscale, sepia and opacity with precise slider controls.</p>
                </div>
                <div class="feature-card">
                    <div class="fc-icon"><i class="fas fa-palette"></i></div>
                    <h3>20+ Pro Filters</h3>
                    <p>Apply stunning filters like Vintage, Cinema, Noir, Warm, Cool, Dramatic, Fade, Arctic and more with a single click.</p>
                </div>
                <div class="feature-card">
                    <div class="fc-icon"><i class="fas fa-crop-alt"></i></div>
                    <h3>Smart Crop & Resize</h3>
                    <p>Crop with preset aspect ratios or free-form. Resize to exact dimensions with automatic aspect ratio locking.</p>
                </div>
                <div class="feature-card">
                    <div class="fc-icon"><i class="fas fa-font"></i></div>
                    <h3>Text & Typography</h3>
                    <p>Add text overlays with custom fonts, sizes, colors, stroke effects and positioning for professional results.</p>
                </div>
                <div class="feature-card">
                    <div class="fc-icon"><i class="fas fa-paint-brush"></i></div>
                    <h3>Drawing & Annotation</h3>
                    <p>Free-hand drawing with customizable brush size, color and opacity. Add shapes like rectangles, circles and arrows.</p>
                </div>
                <div class="feature-card">
                    <div class="fc-icon"><i class="fas fa-download"></i></div>
                    <h3>Multiple Export Formats</h3>
                    <p>Export your edited photos in PNG, JPEG or WebP format with adjustable quality settings.</p>
                </div>
            </div>
        </div>

        <!-- FAQ -->
        <section class="seo-section">
            <h2>Frequently Asked Questions</h2>

            <div class="faq-item">
                <div class="faq-q" onclick="this.parentElement.classList.toggle('open')">
                    How do I edit photos online for free?
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-a"><div class="faq-a-inner">Simply upload your photo by clicking the upload area or dragging your image into the editor. Use the left toolbar to access tools like adjustments, filters, crop, resize, text, and drawing. When you're done editing, click the Export button to download your edited image. Everything is 100% free — no signup or payment needed.</div></div>
            </div>

            <div class="faq-item">
                <div class="faq-q" onclick="this.parentElement.classList.toggle('open')">
                    What image formats are supported?
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-a"><div class="faq-a-inner">Our photo editor supports all major image formats for upload including JPG, JPEG, PNG, WebP, BMP, GIF and SVG. You can export your edited images in PNG, JPEG or WebP format with customizable quality settings.</div></div>
            </div>

            <div class="faq-item">
                <div class="faq-q" onclick="this.parentElement.classList.toggle('open')">
                    Are my photos uploaded to any server?
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-a"><div class="faq-a-inner">No. All image processing happens locally in your browser using HTML5 Canvas technology. Your photos never leave your device. We don't upload, store, or access any of your images. Your privacy is fully protected.</div></div>
            </div>

            <div class="faq-item">
                <div class="faq-q" onclick="this.parentElement.classList.toggle('open')">
                    Can I add text and drawings to my photos?
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-a"><div class="faq-a-inner">Yes! Our photo editor includes a full text tool with customizable fonts, sizes, colors and stroke effects. The drawing tool lets you draw freehand with adjustable brush size and opacity. You can also add shapes like rectangles, circles, lines and arrows.</div></div>
            </div>

            <div class="faq-item">
                <div class="faq-q" onclick="this.parentElement.classList.toggle('open')">
                    Is there a file size limit?
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-a"><div class="faq-a-inner">Since all processing happens in your browser, there's no server-side file size limit. However, very large images (50MB+) may take longer to process depending on your device's memory and processing power. For best performance, images under 20MB are recommended.</div></div>
            </div>

            <div class="faq-item">
                <div class="faq-q" onclick="this.parentElement.classList.toggle('open')">
                    Does the editor add watermarks?
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-a"><div class="faq-a-inner">No, absolutely not. Our photo editor is completely free and we never add any watermarks to your images. The exported image is exactly what you see on screen — clean and professional.</div></div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="site-footer">
            <p>&copy; 2024 Photo Editor Pro. All rights reserved.</p>
            <p style="margin-top:5px">Free online photo editor — Edit, crop, resize, filter and enhance your photos instantly.</p>
        </footer>
    </div>

    <script>
        // ==================== STATE ====================
        let originalImage = null;
        let currentState = null;
        let undoStack = [];
        let redoStack = [];
        let zoomLevel = 100;
        let isDrawing = false;
        let lastX = 0, lastY = 0;
        let currentTool = 'adjust';
        let currentFilter = 'none';
        let selectedShape = 'rect';
        let shapeStartX = 0, shapeStartY = 0;
        let exportFormat = 'png';
        let fileInfo = {};
        let editHistory = [];
        let drawingData = null;

        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });

        // ==================== FILTERS PRESETS ====================
        const filters = [
            { name: 'None', css: '' },
            { name: 'Vivid', css: 'saturate(1.5) contrast(1.1)' },
            { name: 'Warm', css: 'sepia(0.3) saturate(1.4) brightness(1.05)' },
            { name: 'Cool', css: 'saturate(0.9) hue-rotate(15deg) brightness(1.05)' },
            { name: 'Vintage', css: 'sepia(0.5) contrast(0.9) brightness(1.1)' },
            { name: 'Cinema', css: 'contrast(1.2) saturate(0.85) brightness(0.95)' },
            { name: 'Noir', css: 'grayscale(1) contrast(1.3) brightness(0.9)' },
            { name: 'Fade', css: 'contrast(0.8) brightness(1.1) saturate(0.7)' },
            { name: 'Dramatic', css: 'contrast(1.4) saturate(1.2) brightness(0.9)' },
            { name: 'Soft', css: 'brightness(1.1) contrast(0.9) blur(0.5px)' },
            { name: 'Arctic', css: 'hue-rotate(180deg) saturate(0.6) brightness(1.1)' },
            { name: 'Sunset', css: 'sepia(0.4) hue-rotate(-20deg) saturate(1.5)' },
            { name: 'Retro', css: 'sepia(0.6) hue-rotate(-10deg) saturate(1.2) contrast(0.9)' },
            { name: 'B&W Hi', css: 'grayscale(1) contrast(1.6)' },
            { name: 'Moody', css: 'brightness(0.85) contrast(1.2) saturate(0.8)' },
            { name: 'Pop', css: 'saturate(2) contrast(1.15)' },
            { name: 'Pastel', css: 'saturate(0.5) brightness(1.2) contrast(0.85)' },
            { name: 'Chrome', css: 'saturate(1.3) contrast(1.1) brightness(1.05)' },
            { name: 'Emerald', css: 'hue-rotate(90deg) saturate(0.7)' },
            { name: 'Amber', css: 'sepia(0.7) saturate(1.4) hue-rotate(-10deg)' },
        ];

        // Build filter grid
        const filterGrid = document.getElementById('filterGrid');
        filters.forEach((f, i) => {
            const div = document.createElement('div');
            div.className = 'filter-item' + (i === 0 ? ' active' : '');
            div.textContent = f.name;
            div.onclick = () => {
                document.querySelectorAll('.filter-item').forEach(el => el.classList.remove('active'));
                div.classList.add('active');
                currentFilter = f.css;
                applyAllAdjustments();
                addHistory('Filter: ' + f.name);
            };
            filterGrid.appendChild(div);
        });

        // ==================== FILE UPLOAD ====================
        const uploadArea = document.getElementById('uploadArea');

        uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', e => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                loadImageFile(file);
            }
        });

        function loadImage(e) {
            const file = e.target.files[0];
            if (file) loadImageFile(file);
        }

        function loadImageFile(file) {
            fileInfo = {
                name: file.name,
                size: formatFileSize(file.size),
                format: file.type.split('/')[1]?.toUpperCase() || 'Unknown'
            };

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    originalImage = img;

                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);

                    currentState = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    undoStack = [ctx.getImageData(0, 0, canvas.width, canvas.height)];
                    redoStack = [];

                    document.getElementById('uploadPlaceholder').style.display = 'none';
                    document.getElementById('canvasWrapper').style.display = 'block';
                    document.getElementById('zoomBar').style.display = 'flex';

                    // Update info
                    document.getElementById('infoWidth').textContent = img.width + 'px';
                    document.getElementById('infoHeight').textContent = img.height + 'px';
                    document.getElementById('infoFormat').textContent = fileInfo.format;
                    document.getElementById('infoSize').textContent = fileInfo.size;
                    document.getElementById('infoName').textContent = fileInfo.name;

                    document.getElementById('resizeW').value = img.width;
                    document.getElementById('resizeH').value = img.height;
                    document.getElementById('cropW').value = img.width;
                    document.getElementById('cropH').value = img.height;

                    document.getElementById('exportName').value = file.name.split('.')[0] + '-edited';

                    editHistory = [];
                    addHistory('Image loaded');
                    showToast('Image loaded successfully!', 'success');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function formatFileSize(bytes) {
            if (bytes >= 1e6) return (bytes / 1e6).toFixed(2) + ' MB';
            if (bytes >= 1e3) return (bytes / 1e3).toFixed(1) + ' KB';
            return bytes + ' B';
        }

        // ==================== TOOLS ====================
        function switchTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-tool="${tool}"]`).classList.add('active');
            document.querySelectorAll('.panel-section').forEach(p => p.classList.remove('active'));
            const panel = document.getElementById('panel-' + tool);
            if (panel) panel.classList.add('active');

            // Canvas cursor
            if (tool === 'draw' || tool === 'blur') {
                canvas.style.cursor = 'crosshair';
            } else if (tool === 'text') {
                canvas.style.cursor = 'text';
            } else if (tool === 'shapes') {
                canvas.style.cursor = 'crosshair';
            } else {
                canvas.style.cursor = 'default';
            }
        }

        // ==================== ADJUSTMENTS ====================
        function updateAdjustment(el) {
            const val = el.value;
            const id = el.id;
            const valEl = document.getElementById('val-' + id);

            if (['grayscale', 'sepia', 'invert', 'opacity'].includes(id)) {
                valEl.textContent = val + '%';
            } else if (id === 'hue') {
                valEl.textContent = val + '°';
            } else {
                valEl.textContent = val;
            }

            applyAllAdjustments();
        }

        function applyAllAdjustments() {
            if (!originalImage) return;

            const brightness = parseInt(document.getElementById('brightness').value);
            const contrast = parseInt(document.getElementById('contrast').value);
            const saturate = parseInt(document.getElementById('saturate').value);
            const hue = parseInt(document.getElementById('hue').value);
            const exposure = parseInt(document.getElementById('exposure').value);
            const warmth = parseInt(document.getElementById('warmth').value);
            const blurVal = parseInt(document.getElementById('blurAdj').value);
            const grayscale = parseInt(document.getElementById('grayscale').value);
            const sepia = parseInt(document.getElementById('sepia').value);
            const invert = parseInt(document.getElementById('invert').value);
            const opacity = parseInt(document.getElementById('opacity').value);

            const brightnessVal = 100 + brightness + (exposure * 0.5);
            const contrastVal = 100 + contrast;
            const saturateVal = 100 + saturate;

            let cssFilter = `brightness(${brightnessVal}%) contrast(${contrastVal}%) saturate(${saturateVal}%) hue-rotate(${hue}deg) blur(${blurVal}px) grayscale(${grayscale}%) sepia(${sepia}%) invert(${invert}%) opacity(${opacity}%)`;

            if (currentFilter) {
                cssFilter += ' ' + currentFilter;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.filter = cssFilter;
            ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);

            // Warmth
            if (warmth !== 0) {
                const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imgData.data;
                const w = warmth * 0.5;
                for (let i = 0; i < data.length; i += 4) {
                    data[i] = Math.min(255, Math.max(0, data[i] + w));
                    data[i + 2] = Math.min(255, Math.max(0, data[i + 2] - w));
                }
                ctx.filter = 'none';
                ctx.putImageData(imgData, 0, 0);
            }

            ctx.filter = 'none';
        }

        function resetAdjustments() {
            ['brightness', 'contrast', 'saturate', 'exposure', 'warmth'].forEach(id => {
                document.getElementById(id).value = 0;
                document.getElementById('val-' + id).textContent = '0';
            });
            document.getElementById('hue').value = 0;
            document.getElementById('val-hue').textContent = '0°';
            document.getElementById('blurAdj').value = 0;
            document.getElementById('val-blurAdj').textContent = '0';
            document.getElementById('grayscale').value = 0;
            document.getElementById('val-grayscale').textContent = '0%';
            document.getElementById('sepia').value = 0;
            document.getElementById('val-sepia').textContent = '0%';
            document.getElementById('invert').value = 0;
            document.getElementById('val-invert').textContent = '0%';
            document.getElementById('opacity').value = 100;
            document.getElementById('val-opacity').textContent = '100%';
            currentFilter = '';
            document.querySelectorAll('.filter-item').forEach((el, i) => {
                el.classList.toggle('active', i === 0);
            });
            applyAllAdjustments();
            addHistory('Reset adjustments');
        }

        // ==================== CROP ====================
        function applyCrop() {
            if (!originalImage) return;
            const x = parseInt(document.getElementById('cropX').value) || 0;
            const y = parseInt(document.getElementById('cropY').value) || 0;
            const w = parseInt(document.getElementById('cropW').value) || canvas.width;
            const h = parseInt(document.getElementById('cropH').value) || canvas.height;

            if (w <= 0 || h <= 0 || x < 0 || y < 0) {
                showToast('Invalid crop values!', 'error');
                return;
            }

            const imgData = ctx.getImageData(x, y, Math.min(w, canvas.width - x), Math.min(h, canvas.height - y));
            canvas.width = imgData.width;
            canvas.height = imgData.height;
            ctx.putImageData(imgData, 0, 0);

            // Update originalImage
            const tempImg = new Image();
            tempImg.onload = function() {
                originalImage = tempImg;
                updateInfoPanel();
            };
            tempImg.src = canvas.toDataURL();

            saveState();
            addHistory(`Cropped to ${imgData.width}x${imgData.height}`);
            showToast('Image cropped!', 'success');
        }

        function setCropRatio() {
            const ratio = document.getElementById('cropRatio').value;
            if (ratio === 'free') return;
            const [rw, rh] = ratio.split(':').map(Number);
            const maxW = canvas.width;
            const maxH = canvas.height;
            let w = maxW;
            let h = Math.round(w * rh / rw);
            if (h > maxH) { h = maxH; w = Math.round(h * rw / rh); }
            document.getElementById('cropW').value = w;
            document.getElementById('cropH').value = h;
            document.getElementById('cropX').value = Math.round((maxW - w) / 2);
            document.getElementById('cropY').value = Math.round((maxH - h) / 2);
        }

        // ==================== RESIZE ====================
        function lockAspect(changed) {
            if (!document.getElementById('lockRatio').checked || !originalImage) return;
            const ratio = originalImage.width / originalImage.height;
            if (changed === 'w') {
                const w = parseInt(document.getElementById('resizeW').value) || 1;
                document.getElementById('resizeH').value = Math.round(w / ratio);
            } else {
                const h = parseInt(document.getElementById('resizeH').value) || 1;
                document.getElementById('resizeW').value = Math.round(h * ratio);
            }
        }

        function scaleImage() {
            if (!originalImage) return;
            const scale = parseInt(document.getElementById('scaleSlider').value);
            document.getElementById('val-scale').textContent = scale + '%';
            document.getElementById('resizeW').value = Math.round(originalImage.width * scale / 100);
            document.getElementById('resizeH').value = Math.round(originalImage.height * scale / 100);
        }

        function applyResize() {
            if (!originalImage) return;
            const w = parseInt(document.getElementById('resizeW').value) || canvas.width;
            const h = parseInt(document.getElementById('resizeH').value) || canvas.height;

            if (w <= 0 || h <= 0) {
                showToast('Invalid dimensions!', 'error');
                return;
            }

            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = w;
            tempCanvas.height = h;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.drawImage(canvas, 0, 0, w, h);

            canvas.width = w;
            canvas.height = h;
            ctx.drawImage(tempCanvas, 0, 0);

            const tempImg = new Image();
            tempImg.onload = function() {
                originalImage = tempImg;
                updateInfoPanel();
            };
            tempImg.src = canvas.toDataURL();

            saveState();
            addHistory(`Resized to ${w}x${h}`);
            showToast('Image resized!', 'success');
        }

        // ==================== ROTATE & FLIP ====================
        function updateRotation() {
            document.getElementById('val-rotation').textContent = document.getElementById('rotation').value + '°';
        }

        function rotateFixed(deg) {
            if (!originalImage) return;
            const rad = deg * Math.PI / 180;
            const w = canvas.width;
            const h = canvas.height;

            const tempCanvas = document.createElement('canvas');
            if (Math.abs(deg) === 90 || Math.abs(deg) === 270) {
                tempCanvas.width = h;
                tempCanvas.height = w;
            } else {
                tempCanvas.width = w;
                tempCanvas.height = h;
            }
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.translate(tempCanvas.width / 2, tempCanvas.height / 2);
            tempCtx.rotate(rad);
            tempCtx.drawImage(canvas, -w / 2, -h / 2);

            canvas.width = tempCanvas.width;
            canvas.height = tempCanvas.height;
            ctx.drawImage(tempCanvas, 0, 0);

            const tempImg = new Image();
            tempImg.onload = function() { originalImage = tempImg; updateInfoPanel(); };
            tempImg.src = canvas.toDataURL();

            saveState();
            addHistory(`Rotated ${deg}°`);
            showToast(`Rotated ${deg}°`, 'success');
        }

        function applyRotation() {
            const deg = parseInt(document.getElementById('rotation').value);
            if (deg === 0) return;
            rotateFixed(deg);
            document.getElementById('rotation').value = 0;
            document.getElementById('val-rotation').textContent = '0°';
        }

        function flipImage(dir) {
            if (!originalImage) return;
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');

            if (dir === 'h') {
                tempCtx.translate(canvas.width, 0);
                tempCtx.scale(-1, 1);
            } else {
                tempCtx.translate(0, canvas.height);
                tempCtx.scale(1, -1);
            }
            tempCtx.drawImage(canvas, 0, 0);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(tempCanvas, 0, 0);

            const tempImg = new Image();
            tempImg.onload = function() { originalImage = tempImg; };
            tempImg.src = canvas.toDataURL();

            saveState();
            addHistory(`Flipped ${dir === 'h' ? 'horizontal' : 'vertical'}`);
            showToast(`Flipped ${dir === 'h' ? 'horizontally' : 'vertically'}!`, 'success');
        }

        function mirrorImage() { flipImage('h'); }

        // ==================== TEXT ====================
        function addText() {
            if (!originalImage) return;
            const text = document.getElementById('textInput').value;
            if (!text) { showToast('Enter text first!', 'error'); return; }

            const font = document.getElementById('fontFamily').value;
            const size = document.getElementById('fontSize').value;
            const weight = document.getElementById('fontWeight').value;
            const color = document.getElementById('textColor').value;
            const stroke = document.getElementById('textStroke').value;
            const strokeW = parseInt(document.getElementById('strokeWidth').value);

            ctx.font = `${weight} ${size}px ${font}`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            if (strokeW > 0) {
                ctx.strokeStyle = stroke;
                ctx.lineWidth = strokeW;
                ctx.strokeText(text, canvas.width / 2, canvas.height / 2);
            }
            ctx.fillStyle = color;
            ctx.fillText(text, canvas.width / 2, canvas.height / 2);

            const tempImg = new Image();
            tempImg.onload = function() { originalImage = tempImg; };
            tempImg.src = canvas.toDataURL();

            saveState();
            addHistory('Added text: ' + text);
            showToast('Text added!', 'success');
        }

        // ==================== DRAWING ====================
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDraw);
        canvas.addEventListener('mouseleave', stopDraw);

        // Touch support
        canvas.addEventListener('touchstart', e => { e.preventDefault(); const t = getTouch(e); startDraw(t); });
        canvas.addEventListener('touchmove', e => { e.preventDefault(); const t = getTouch(e); draw(t); });
        canvas.addEventListener('touchend', e => { e.preventDefault(); stopDraw(e); });

        function getTouch(e) {
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            return {
                offsetX: (touch.clientX - rect.left) * (canvas.width / rect.width),
                offsetY: (touch.clientY - rect.top) * (canvas.height / rect.height)
            };
        }

        function startDraw(e) {
            if (currentTool !== 'draw' && currentTool !== 'shapes') return;
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            lastX = e.offsetX !== undefined ? e.offsetX * (canvas.width / rect.width) : e.offsetX;
            lastY = e.offsetY !== undefined ? e.offsetY * (canvas.height / rect.height) : e.offsetY;

            // Correct for canvas scaling
            if (e.offsetX !== undefined) {
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                lastX = e.offsetX * scaleX;
                lastY = e.offsetY * scaleY;
            }

            if (currentTool === 'shapes') {
                shapeStartX = lastX;
                shapeStartY = lastY;
                drawingData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }
        }

        function draw(e) {
            if (!isDrawing) return;

            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            let x, y;

            if (e.offsetX !== undefined) {
                x = e.offsetX * scaleX;
                y = e.offsetY * scaleY;
            } else {
                x = e.offsetX;
                y = e.offsetY;
            }

            if (currentTool === 'draw') {
                const drawToolType = document.getElementById('drawTool').value;
                const brushSize = parseInt(document.getElementById('brushSize').value);
                const brushOpacity = parseInt(document.getElementById('brushOpacity').value) / 100;
                const drawColorVal = document.getElementById('drawColor').value;

                ctx.globalAlpha = brushOpacity;
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';

                if (drawToolType === 'eraser') {
                    ctx.globalCompositeOperation = 'destination-out';
                } else {
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.strokeStyle = drawColorVal;
                }

                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();

                ctx.globalAlpha = 1;
                ctx.globalCompositeOperation = 'source-over';
            }

            if (currentTool === 'shapes' && drawingData) {
                ctx.putImageData(drawingData, 0, 0);
                const color = document.getElementById('shapeColor').value;
                const borderW = parseInt(document.getElementById('shapeBorder').value);
                const fill = document.getElementById('shapeFill').checked;

                ctx.strokeStyle = color;
                ctx.fillStyle = color;
                ctx.lineWidth = borderW;

                if (selectedShape === 'rect') {
                    if (fill) ctx.fillRect(shapeStartX, shapeStartY, x - shapeStartX, y - shapeStartY);
                    ctx.strokeRect(shapeStartX, shapeStartY, x - shapeStartX, y - shapeStartY);
                } else if (selectedShape === 'circle') {
                    const rx = Math.abs(x - shapeStartX) / 2;
                    const ry = Math.abs(y - shapeStartY) / 2;
                    const cx = shapeStartX + (x - shapeStartX) / 2;
                    const cy = shapeStartY + (y - shapeStartY) / 2;
                    ctx.beginPath();
                    ctx.ellipse(cx, cy, rx, ry, 0, 0, Math.PI * 2);
                    if (fill) ctx.fill();
                    ctx.stroke();
                } else if (selectedShape === 'line') {
                    ctx.beginPath();
                    ctx.moveTo(shapeStartX, shapeStartY);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                } else if (selectedShape === 'arrow') {
                    drawArrow(ctx, shapeStartX, shapeStartY, x, y, borderW);
                }
            }

            lastX = x;
            lastY = y;
        }

        function stopDraw() {
            if (isDrawing && (currentTool === 'draw' || currentTool === 'shapes')) {
                const tempImg = new Image();
                tempImg.onload = function() { originalImage = tempImg; };
                tempImg.src = canvas.toDataURL();
                saveState();
                if (currentTool === 'draw') addHistory('Drawing added');
                if (currentTool === 'shapes') addHistory('Shape: ' + selectedShape);
            }
            isDrawing = false;
            drawingData = null;
        }

        function drawArrow(ctx, fx, fy, tx, ty, w) {
            const headLen = w * 5;
            const angle = Math.atan2(ty - fy, tx - fx);
            ctx.beginPath();
            ctx.moveTo(fx, fy);
            ctx.lineTo(tx, ty);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(tx, ty);
            ctx.lineTo(tx - headLen * Math.cos(angle - Math.PI / 6), ty - headLen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(tx - headLen * Math.cos(angle + Math.PI / 6), ty - headLen * Math.sin(angle + Math.PI / 6));
            ctx.closePath();
            ctx.fill();
        }

        function selectShape(shape, el) {
            selectedShape = shape;
            document.querySelectorAll('#panel-shapes .filter-item').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
        }

        function clearDrawing() {
            if (!originalImage) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
            addHistory('Cleared drawing');
        }

        // ==================== VIGNETTE ====================
        function applyVignette() {
            if (!originalImage) return;
            const intensity = parseInt(document.getElementById('vigIntensity').value);
            const size = parseInt(document.getElementById('vigSize').value);
            document.getElementById('val-vigIntensity').textContent = intensity;
            document.getElementById('val-vigSize').textContent = size;

            applyAllAdjustments();

            if (intensity > 0) {
                const cx = canvas.width / 2;
                const cy = canvas.height / 2;
                const radius = Math.max(cx, cy) * (size / 50);
                const gradient = ctx.createRadialGradient(cx, cy, radius * 0.3, cx, cy, radius);
                gradient.addColorStop(0, `rgba(0,0,0,0)`);
                gradient.addColorStop(1, `rgba(0,0,0,${intensity / 100})`);
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        }

        // ==================== QUICK ACTIONS ====================
        function autoEnhance() {
            if (!originalImage) return;
            document.getElementById('brightness').value = 10;
            document.getElementById('contrast').value = 15;
            document.getElementById('saturate').value = 20;
            document.getElementById('val-brightness').textContent = '10';
            document.getElementById('val-contrast').textContent = '15';
            document.getElementById('val-saturate').textContent = '20';
            applyAllAdjustments();
            saveState();
            addHistory('Auto enhanced');
            showToast('Auto enhanced!', 'success');
        }

        function makeGrayscale() {
            if (!originalImage) return;
            document.getElementById('grayscale').value = 100;
            document.getElementById('val-grayscale').textContent = '100%';
            applyAllAdjustments();
            saveState();
            addHistory('Grayscale applied');
            showToast('Grayscale applied!', 'success');
        }

        function makeSepia() {
            if (!originalImage) return;
            document.getElementById('sepia').value = 80;
            document.getElementById('val-sepia').textContent = '80%';
            applyAllAdjustments();
            saveState();
            addHistory('Sepia applied');
            showToast('Sepia applied!', 'success');
        }

        function invertColors() {
            if (!originalImage) return;
            document.getElementById('invert').value = 100;
            document.getElementById('val-invert').textContent = '100%';
            applyAllAdjustments();
            saveState();
            addHistory('Colors inverted');
            showToast('Colors inverted!', 'success');
        }

        // ==================== UNDO / REDO ====================
        function saveState() {
            const state = ctx.getImageData(0, 0, canvas.width, canvas.height);
            undoStack.push(state);
            redoStack = [];
            if (undoStack.length > 30) undoStack.shift();
            updateUndoRedoBtns();
        }

        function undoAction() {
            if (undoStack.length <= 1) return;
            redoStack.push(undoStack.pop());
            const state = undoStack[undoStack.length - 1];
            canvas.width = state.width;
            canvas.height = state.height;
            ctx.putImageData(state, 0, 0);
            const tempImg = new Image();
            tempImg.onload = function() { originalImage = tempImg; updateInfoPanel(); };
            tempImg.src = canvas.toDataURL();
            updateUndoRedoBtns();
            addHistory('Undo');
        }

        function redoAction() {
            if (redoStack.length === 0) return;
            const state = redoStack.pop();
            undoStack.push(state);
            canvas.width = state.width;
            canvas.height = state.height;
            ctx.putImageData(state, 0, 0);
            const tempImg = new Image();
            tempImg.onload = function() { originalImage = tempImg; updateInfoPanel(); };
            tempImg.src = canvas.toDataURL();
            updateUndoRedoBtns();
            addHistory('Redo');
        }

        function updateUndoRedoBtns() {
            document.getElementById('undoBtn').disabled = undoStack.length <= 1;
            document.getElementById('redoBtn').disabled = redoStack.length === 0;
        }

        // ==================== RESET ====================
        function resetAll() {
            if (!originalImage) return;
            if (!confirm('Reset all changes? This cannot be undone.')) return;
            resetAdjustments();
            if (undoStack.length > 0) {
                const first = undoStack[0];
                canvas.width = first.width;
                canvas.height = first.height;
                ctx.putImageData(first, 0, 0);
                const tempImg = new Image();
                tempImg.onload = function() { originalImage = tempImg; updateInfoPanel(); };
                tempImg.src = canvas.toDataURL();
            }
            undoStack = [undoStack[0]];
            redoStack = [];
            updateUndoRedoBtns();
            editHistory = [];
            addHistory('Reset all');
            showToast('All changes reset!', 'success');
        }

        // ==================== ZOOM ====================
        function changeZoom(delta) {
            setZoom(Math.max(10, Math.min(300, zoomLevel + delta)));
        }

        function setZoom(val) {
            zoomLevel = parseInt(val);
            document.getElementById('zoomSlider').value = zoomLevel;
            document.getElementById('zoomVal').textContent = zoomLevel + '%';
            canvas.style.transform = `scale(${zoomLevel / 100})`;
            canvas.style.transformOrigin = 'center center';
        }

        // ==================== EXPORT ====================
        function openExportModal() {
            if (!originalImage) { showToast('Load an image first!', 'error'); return; }
            document.getElementById('exportModal').classList.add('show');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('show');
        }

        function selectFormat(fmt, el) {
            exportFormat = fmt;
            document.querySelectorAll('.export-format').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
        }

        function exportImage() {
            const quality = parseInt(document.getElementById('exportQuality').value) / 100;
            const name = document.getElementById('exportName').value || 'edited-photo';
            const mimeType = exportFormat === 'jpeg' ? 'image/jpeg' : exportFormat === 'webp' ? 'image/webp' : 'image/png';

            // Apply current adjustments to export
            const exportCanvas = document.createElement('canvas');
            exportCanvas.width = canvas.width;
            exportCanvas.height = canvas.height;
            const exportCtx = exportCanvas.getContext('2d');
            exportCtx.drawImage(canvas, 0, 0);

            const dataURL = exportCanvas.toDataURL(mimeType, quality);
            const link = document.createElement('a');
            link.download = `${name}.${exportFormat}`;
            link.href = dataURL;
            link.click();

            closeExportModal();
            addHistory(`Exported as ${exportFormat.toUpperCase()}`);
            showToast(`Image downloaded as ${exportFormat.toUpperCase()}!`, 'success');
        }

        // ==================== HELPERS ====================
        function updateInfoPanel() {
            document.getElementById('infoWidth').textContent = canvas.width + 'px';
            document.getElementById('infoHeight').textContent = canvas.height + 'px';
            document.getElementById('resizeW').value = canvas.width;
            document.getElementById('resizeH').value = canvas.height;
            document.getElementById('cropW').value = canvas.width;
            document.getElementById('cropH').value = canvas.height;
        }

        function addHistory(action) {
            editHistory.unshift(action);
            if (editHistory.length > 20) editHistory.pop();
            const list = document.getElementById('historyList');
            list.innerHTML = editHistory.map(h => `<div class="history-item"><i class="fas fa-circle" style="font-size:6px"></i> ${h}</div>`).join('');
        }

        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = toast.querySelector('i');
            document.getElementById('toastMsg').textContent = msg;
            toast.className = 'toast ' + type;
            icon.className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'z') { e.preventDefault(); undoAction(); }
            if (e.ctrlKey && e.key === 'y') { e.preventDefault(); redoAction(); }
            if (e.ctrlKey && e.key === 's') { e.preventDefault(); openExportModal(); }
            if (e.ctrlKey && e.key === 'o') { e.preventDefault(); document.getElementById('fileInput').click(); }
        });

        // Prevent page scroll on canvas
        canvas.addEventListener('wheel', function(e) {
            e.preventDefault();
            changeZoom(e.deltaY > 0 ? -5 : 5);
        });
    </script>
</body>
</html>
