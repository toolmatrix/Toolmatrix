<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Free Online Photo Editor - Crop, Resize, Filters & Effects | ToolMatrix</title>
    <meta name="description" content="Free professional online photo editor. Crop, resize, rotate, add filters, adjust brightness, contrast, draw, add text. No download required!">
    <meta name="keywords" content="photo editor, online photo editor, free photo editor, image editor, edit photos online, crop image, resize image, photo filters">
    <meta name="robots" content="index, follow">
    <meta name="author" content="ToolMatrix">
    <link rel="canonical" href="https://toolmatrix.com/photo-editor">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Free Online Photo Editor - ToolMatrix">
    <meta property="og:description" content="Edit photos online for free. Crop, resize, filters, draw, text & more.">
    <meta property="og:url" content="https://toolmatrix.com/photo-editor">
    <meta property="og:site_name" content="ToolMatrix">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Free Online Photo Editor - ToolMatrix">

    <script type="application/ld+json">
    {"@context":"https://schema.org","@type":"WebApplication","name":"ToolMatrix Photo Editor","description":"Free professional online photo editor with filters, crop, resize, draw, text overlay and color adjustments.","url":"https://toolmatrix.com/photo-editor","applicationCategory":"MultimediaApplication","operatingSystem":"All","publisher":{"@type":"Organization","name":"ToolMatrix"},"offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}
    </script>
    <script type="application/ld+json">
    {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"Is this photo editor free?","acceptedAnswer":{"@type":"Answer","text":"Yes, 100% free with no watermarks or registration."}},{"@type":"Question","name":"Do I need to download software?","acceptedAnswer":{"@type":"Answer","text":"No, it works entirely in your browser."}},{"@type":"Question","name":"Are my photos safe?","acceptedAnswer":{"@type":"Answer","text":"Yes, all processing happens locally in your browser. Photos never leave your device."}}]}
    </script>

    <style>
        *{margin:0;padding:0;box-sizing:border-box}

        /* ===== THEME VARIABLES ===== */
        :root,[data-theme="light"]{
            --bg:#f0f2f5;--bg2:#ffffff;--bg3:#f8fafc;--bg-canvas:#e2e5ea;
            --text:#1e293b;--text2:#475569;--text3:#64748b;--text4:#94a3b8;
            --border:#e2e8f0;--border2:#cbd5e1;
            --accent:#4f46e5;--accent2:#7c3aed;--accent-bg:rgba(79,70,229,0.08);
            --accent-border:rgba(79,70,229,0.25);
            --shadow:0 2px 12px rgba(0,0,0,0.06);
            --shadow2:0 8px 30px rgba(0,0,0,0.1);
            --input-bg:#f1f5f9;--hover-bg:#eef2ff;
            --slider-track:#e2e8f0;--slider-thumb:#4f46e5;
            --danger:#ef4444;--success:#10b981;--pink:#ec4899;
            --check-bg:#e0e7ff;
            --header-border:#4f46e5;
            --canvas-checker1:#d5d8dc;--canvas-checker2:#e8eaed;
            --scroll-thumb:rgba(0,0,0,0.15);
        }
        [data-theme="dark"]{
            --bg:#0f172a;--bg2:#1e293b;--bg3:#334155;--bg-canvas:#0c1322;
            --text:#f1f5f9;--text2:#cbd5e1;--text3:#94a3b8;--text4:#64748b;
            --border:rgba(255,255,255,0.08);--border2:rgba(255,255,255,0.12);
            --accent:#818cf8;--accent2:#a78bfa;--accent-bg:rgba(129,140,248,0.1);
            --accent-border:rgba(129,140,248,0.3);
            --shadow:0 2px 12px rgba(0,0,0,0.3);
            --shadow2:0 8px 30px rgba(0,0,0,0.4);
            --input-bg:rgba(255,255,255,0.06);--hover-bg:rgba(129,140,248,0.08);
            --slider-track:rgba(255,255,255,0.1);--slider-thumb:#818cf8;
            --danger:#f87171;--success:#34d399;--pink:#f472b6;
            --check-bg:rgba(129,140,248,0.15);
            --header-border:#818cf8;
            --canvas-checker1:#131c2e;--canvas-checker2:#172035;
            --scroll-thumb:rgba(255,255,255,0.15);
        }

        body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text)}

        /* ===== EDITOR WRAPPER ===== */
        .editor-wrap{height:100vh;display:flex;flex-direction:column;overflow:hidden}

        /* ===== HEADER ===== */
        .ed-header{
            background:var(--bg2);display:flex;align-items:center;justify-content:space-between;
            padding:0 16px;height:52px;min-height:52px;border-bottom:2px solid var(--header-border);
            box-shadow:var(--shadow);z-index:50;gap:8px;
        }
        .logo{display:flex;align-items:center;gap:8px;font-weight:800;font-size:1.1rem;color:var(--text);white-space:nowrap}
        .logo-icon{
            width:34px;height:34px;background:linear-gradient(135deg,var(--accent),var(--accent2));
            border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:1rem;color:#fff;
        }
        .hdr-btns{display:flex;gap:5px;align-items:center;flex-wrap:nowrap;overflow-x:auto}
        .hb{
            padding:7px 12px;border:none;border-radius:8px;font-size:0.78rem;font-weight:700;
            cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:4px;
            white-space:nowrap;color:var(--text);background:var(--input-bg);
        }
        .hb:hover{background:var(--accent-bg);color:var(--accent)}
        .hb.primary{background:var(--accent);color:#fff}
        .hb.primary:hover{opacity:0.9}
        .hb.save{background:linear-gradient(135deg,#059669,var(--success));color:#fff}
        .hb.danger{color:var(--danger)}
        .hb .bl{display:inline}
        .theme-toggle{
            width:38px;height:38px;border:2px solid var(--border);border-radius:10px;
            background:var(--input-bg);cursor:pointer;font-size:1.1rem;display:flex;
            align-items:center;justify-content:center;transition:all 0.3s;flex-shrink:0;
        }
        .theme-toggle:hover{border-color:var(--accent);background:var(--accent-bg)}

        /* ===== EDITOR BODY ===== */
        .ed-body{flex:1;display:flex;overflow:hidden}

        /* ===== SIDEBAR ===== */
        .sidebar{
            width:290px;min-width:290px;background:var(--bg2);border-right:1px solid var(--border);
            display:flex;flex-direction:column;overflow:hidden;
        }
        .tab-bar{
            display:flex;background:var(--bg);border-bottom:1px solid var(--border);
            overflow-x:auto;flex-shrink:0;-webkit-overflow-scrolling:touch;
        }
        .tab-bar::-webkit-scrollbar{height:0}
        .tb{
            flex:1;min-width:58px;padding:8px 4px;text-align:center;font-size:0.6rem;
            font-weight:600;color:var(--text3);cursor:pointer;border-bottom:2px solid transparent;
            transition:all 0.2s;white-space:nowrap;
        }
        .tb:hover{color:var(--text);background:var(--hover-bg)}
        .tb.active{color:var(--accent);border-bottom-color:var(--accent);background:var(--accent-bg)}
        .tb .ti{font-size:1rem;display:block;margin-bottom:1px}
        .panels{flex:1;overflow-y:auto;overflow-x:hidden}
        .panels::-webkit-scrollbar{width:4px}
        .panels::-webkit-scrollbar-thumb{background:var(--scroll-thumb);border-radius:4px}
        .pnl{display:none;padding:14px}
        .pnl.active{display:block}
        .pnl-title{font-size:0.75rem;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:12px;padding-bottom:7px;border-bottom:1px solid var(--border)}

        /* Slider */
        .sg{margin-bottom:14px}
        .sl{display:flex;justify-content:space-between;margin-bottom:5px}
        .sl span{font-size:0.8rem;color:var(--text2)}
        .sv{font-size:0.72rem;font-weight:700;color:var(--accent);background:var(--accent-bg);padding:1px 6px;border-radius:3px}
        input[type="range"]{width:100%;-webkit-appearance:none;height:5px;border-radius:3px;background:var(--slider-track);outline:none;cursor:pointer}
        input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--slider-thumb);cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,0.3)}
        input[type="range"]::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:var(--slider-thumb);cursor:pointer;border:none}

        /* Filter grid */
        .fg{display:grid;grid-template-columns:repeat(3,1fr);gap:5px}
        .fi{
            background:var(--input-bg);border:2px solid transparent;border-radius:8px;
            padding:9px 3px;text-align:center;cursor:pointer;font-size:0.65rem;
            font-weight:600;color:var(--text3);transition:all 0.2s;
        }
        .fi:hover{background:var(--accent-bg);border-color:var(--accent-border);color:var(--text)}
        .fi.active{background:var(--accent-bg);border-color:var(--accent);color:var(--accent)}
        .fi .fc{font-size:1.15rem;display:block;margin-bottom:3px}

        /* Button grid */
        .bg2{display:grid;grid-template-columns:repeat(2,1fr);gap:5px}
        .gb{
            background:var(--input-bg);border:1px solid var(--border);color:var(--text2);
            padding:10px 6px;border-radius:8px;cursor:pointer;font-size:0.75rem;font-weight:600;
            transition:all 0.2s;display:flex;flex-direction:column;align-items:center;gap:3px;
        }
        .gb:hover{background:var(--accent-bg);border-color:var(--accent);color:var(--accent)}
        .gb.active{background:var(--accent-bg);border-color:var(--accent);color:var(--accent)}
        .gb .gi{font-size:1rem}

        /* Form */
        .fg2{margin-bottom:10px}
        .fg2 label{display:block;font-size:0.8rem;color:var(--text3);margin-bottom:4px}
        .fg2 input,.fg2 select,.fg2 textarea{
            width:100%;padding:8px 10px;background:var(--input-bg);border:1px solid var(--border);
            border-radius:7px;color:var(--text);font-size:0.85rem;outline:none;transition:border 0.2s;
        }
        .fg2 textarea{resize:vertical;min-height:45px}
        .fg2 input:focus,.fg2 select:focus,.fg2 textarea:focus{border-color:var(--accent)}
        .fg2 select option{background:var(--bg2)}
        .cr{display:flex;align-items:center;gap:8px;margin-bottom:8px}
        .cr label{font-size:0.8rem;color:var(--text3);min-width:60px;margin:0}
        .cr input[type="color"]{width:34px;height:30px;border:2px solid var(--border);border-radius:6px;cursor:pointer;background:transparent;padding:2px}
        .chk{display:flex;align-items:center;gap:6px;font-size:0.8rem;color:var(--text3);margin-bottom:6px}
        .chk input{accent-color:var(--accent)}
        .row2{display:flex;gap:6px}
        .row2 .fg2{flex:1}

        .abtn{
            width:100%;padding:10px;border:none;border-radius:8px;font-size:0.85rem;
            font-weight:700;cursor:pointer;transition:all 0.2s;color:#fff;margin-top:6px;
        }
        .abtn:hover{transform:translateY(-1px)}
        .abtn.pri{background:var(--accent)}
        .abtn.suc{background:linear-gradient(135deg,#059669,var(--success))}
        .abtn.dan{background:var(--input-bg);color:var(--danger)}

        /* ===== CANVAS AREA ===== */
        .canvas-area{
            flex:1;display:flex;align-items:center;justify-content:center;
            background:var(--bg-canvas);position:relative;overflow:hidden;
            background-image:linear-gradient(45deg,var(--canvas-checker1) 25%,transparent 25%),linear-gradient(-45deg,var(--canvas-checker1) 25%,transparent 25%),linear-gradient(45deg,transparent 75%,var(--canvas-checker1) 75%),linear-gradient(-45deg,transparent 75%,var(--canvas-checker1) 75%);
            background-size:20px 20px;background-position:0 0,0 10px,10px -10px,-10px 0;
        }

        .upload-screen{text-align:center;z-index:2;position:relative;padding:20px}
        .drop-zone{
            width:360px;max-width:85vw;border:3px dashed var(--border2);border-radius:20px;
            padding:45px 20px;cursor:pointer;transition:all 0.3s;background:var(--bg2);
        }
        .drop-zone:hover,.drop-zone.drag{border-color:var(--accent);background:var(--accent-bg)}
        .drop-zone .ui{font-size:3.5rem;margin-bottom:12px;display:block}
        .drop-zone h2{font-size:1.2rem;color:var(--text);margin-bottom:6px}
        .drop-zone p{color:var(--text3);font-size:0.85rem;margin-bottom:16px}
        .bbtn{display:inline-block;padding:11px 24px;background:var(--accent);color:#fff;border-radius:10px;font-weight:700;font-size:0.9rem}

        .canvas-box{display:none;position:relative}
        #mainCanvas{max-width:100%;max-height:calc(100vh - 60px);display:block;box-shadow:var(--shadow2);border-radius:3px}
        #drawCanvas{position:absolute;top:0;left:0;cursor:crosshair;touch-action:none}

        .info-bar{
            position:absolute;bottom:8px;left:50%;transform:translateX(-50%);
            background:rgba(0,0,0,0.65);backdrop-filter:blur(6px);padding:4px 12px;
            border-radius:12px;font-size:0.72rem;color:rgba(255,255,255,0.7);z-index:5;
            white-space:nowrap;display:none;
        }

        /* ===== TOAST ===== */
        .toast{
            position:fixed;top:62px;right:16px;padding:10px 18px;border-radius:10px;
            font-weight:600;font-size:0.82rem;z-index:1000;transform:translateX(130%);
            transition:transform 0.35s ease;max-width:85vw;color:#fff;
        }
        .toast.show{transform:translateX(0)}
        .toast.ok{background:linear-gradient(135deg,#059669,var(--success))}
        .toast.err{background:linear-gradient(135deg,#dc2626,var(--danger))}
        .toast.info{background:linear-gradient(135deg,var(--accent),var(--accent2))}

        /* ===== PAGE CONTENT (SEO) ===== */
        .page-content{background:var(--bg)}
        .cw{max-width:900px;margin:0 auto;padding:40px 20px}

        .seo-box{background:var(--bg2);border-radius:16px;padding:35px;margin-bottom:35px;border:1px solid var(--border);box-shadow:var(--shadow)}
        .seo-box h2{color:var(--accent);font-size:1.35rem;margin:22px 0 10px;padding-bottom:6px;border-bottom:2px solid var(--border)}
        .seo-box h2:first-child{margin-top:0}
        .seo-box h3{color:var(--text);font-size:1.1rem;margin:16px 0 8px}
        .seo-box p{color:var(--text2);line-height:1.75;margin-bottom:12px;font-size:0.95rem}
        .seo-box ul,.seo-box ol{padding-left:22px;margin-bottom:12px;color:var(--text2);line-height:1.9;font-size:0.95rem}

        /* Related Tools */
        .rt-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:18px;margin-top:20px}
        .rt-card{
            background:var(--bg2);border:2px solid var(--border);border-radius:14px;
            padding:24px 18px;transition:all 0.3s;cursor:pointer;text-decoration:none;
            color:inherit;display:block;position:relative;overflow:hidden;
        }
        .rt-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent),var(--accent2));transform:scaleX(0);transition:transform 0.3s;transform-origin:left}
        .rt-card:hover::before{transform:scaleX(1)}
        .rt-card:hover{transform:translateY(-5px);border-color:var(--accent-border);box-shadow:var(--shadow2)}
        .rt-card .rt-ico{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;margin-bottom:12px;background:var(--accent-bg)}
        .rt-card .rt-name{font-size:1.05rem;font-weight:700;color:var(--text);margin-bottom:6px}
        .rt-card .rt-desc{font-size:0.82rem;color:var(--text3);line-height:1.5}
        .rt-card .rt-arr{margin-top:10px;font-size:0.8rem;font-weight:600;color:var(--accent);transition:gap 0.3s;display:inline-flex;align-items:center;gap:4px}
        .rt-card:hover .rt-arr{gap:10px}

        /* FAQ */
        .fq-item{border:1px solid var(--border);border-radius:10px;margin-bottom:10px;overflow:hidden;background:var(--bg2)}
        .fq-item:hover{border-color:var(--accent-border)}
        .fq-q{padding:14px 16px;background:var(--bg3);cursor:pointer;font-weight:600;color:var(--text);display:flex;justify-content:space-between;align-items:center;font-size:0.92rem;transition:background 0.2s}
        .fq-q:hover{background:var(--hover-bg)}
        .fq-q::after{content:'+';font-size:1.3rem;font-weight:700;color:var(--accent);min-width:18px;text-align:center}
        .fq-item.open .fq-q::after{content:'‚àí'}
        .fq-a{max-height:0;overflow:hidden;transition:all 0.3s;color:var(--text2);line-height:1.7;padding:0 16px;font-size:0.9rem}
        .fq-item.open .fq-a{max-height:300px;padding:12px 16px}

        /* ===== FOOTER ===== */
        .site-footer{background:var(--bg2);border-top:3px solid var(--accent);margin-top:0}
        .ft-main{max-width:1100px;margin:0 auto;padding:45px 20px 25px;display:grid;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));gap:35px}
        .ft-col h3{color:var(--text);font-size:1.05rem;margin-bottom:14px;position:relative;padding-bottom:8px}
        .ft-col h3::after{content:'';position:absolute;bottom:0;left:0;width:35px;height:3px;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:2px}
        .ft-brand .bn{display:flex;align-items:center;gap:8px;font-size:1.25rem;font-weight:800;color:var(--text);margin-bottom:12px}
        .ft-brand .bi{width:34px;height:34px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:1rem;color:#fff}
        .ft-brand p{color:var(--text3);line-height:1.6;font-size:0.85rem}
        .ft-social{display:flex;gap:8px;margin-top:12px}
        .ft-social a{width:36px;height:36px;border-radius:8px;background:var(--input-bg);display:flex;align-items:center;justify-content:center;color:var(--text3);text-decoration:none;font-size:1rem;transition:all 0.3s;border:1px solid var(--border)}
        .ft-social a:hover{background:var(--accent);color:#fff;border-color:var(--accent);transform:translateY(-2px)}
        .ft-col ul{list-style:none}
        .ft-col ul li{margin-bottom:8px}
        .ft-col ul li a{color:var(--text3);text-decoration:none;font-size:0.85rem;transition:all 0.2s;display:flex;align-items:center;gap:6px}
        .ft-col ul li a:hover{color:var(--accent);padding-left:4px}
        .ft-col ul li a .li{font-size:0.75rem}
        .nl-form{display:flex;gap:6px;margin-top:8px}
        .nl-form input{flex:1;padding:9px 12px;background:var(--input-bg);border:1px solid var(--border);border-radius:7px;color:var(--text);font-size:0.82rem;outline:none}
        .nl-form input:focus{border-color:var(--accent)}
        .nl-form input::placeholder{color:var(--text4)}
        .nl-form button{padding:9px 15px;background:var(--accent);color:#fff;border:none;border-radius:7px;font-weight:700;font-size:0.8rem;cursor:pointer;transition:all 0.2s;white-space:nowrap}
        .nl-form button:hover{opacity:0.9}
        .nl-msg{margin-top:6px;font-size:0.78rem;color:var(--success);display:none}
        .ft-bottom{border-top:1px solid var(--border);padding:16px 20px}
        .ft-bottom-inner{max-width:1100px;margin:0 auto;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:8px}
        .ft-bottom p{color:var(--text4);font-size:0.8rem}
        .ft-bottom a{color:var(--accent);text-decoration:none}
        .ft-bottom a:hover{text-decoration:underline}
        .ft-blinks{display:flex;gap:16px;flex-wrap:wrap}
        .ft-blinks a{color:var(--text4);font-size:0.78rem;text-decoration:none;transition:color 0.2s}
        .ft-blinks a:hover{color:var(--accent)}

        /* ===== RESPONSIVE ===== */
        @media(max-width:850px){
            .ed-body{flex-direction:column-reverse}
            .sidebar{width:100%;min-width:100%;max-height:48vh;border-right:none;border-top:1px solid var(--border)}
            .canvas-area{min-height:52vh}
            #mainCanvas{max-height:48vh}
            .hb .bl{display:none}
            .hb{padding:7px 8px}
            .ed-header{padding:0 10px;height:48px;min-height:48px}
            .logo{font-size:0.95rem}
        }
        @media(max-width:500px){
            .tb{min-width:48px;padding:6px 2px;font-size:0.52rem}
            .tb .ti{font-size:0.9rem}
            .fg{grid-template-columns:repeat(2,1fr)}
            .drop-zone{padding:30px 15px}
            .drop-zone .ui{font-size:2.8rem}
            .drop-zone h2{font-size:1rem}
            .seo-box{padding:22px 16px}
            .ft-main{grid-template-columns:1fr;gap:25px}
            .ft-bottom-inner{flex-direction:column;text-align:center}
            .ft-blinks{justify-content:center}
            .nl-form{flex-direction:column}
            .rt-grid{grid-template-columns:1fr}
        }

        input[type="file"]{display:none}
    </style>
</head>
<body>

<div class="toast" id="toast"></div>
<input type="file" id="fileInput" accept="image/*">

<!-- ===== EDITOR ===== -->
<div class="editor-wrap">
    <header class="ed-header">
        <div class="logo"><div class="logo-icon">üñºÔ∏è</div><span>PhotoEdit Pro</span></div>
        <div class="hdr-btns">
            <button class="hb primary" onclick="openFile()">üìÅ <span class="bl">Open</span></button>
            <button class="hb" onclick="undo()">‚Ü©Ô∏è</button>
            <button class="hb" onclick="redo()">‚Ü™Ô∏è</button>
            <button class="hb danger" onclick="resetAll()">üóëÔ∏è</button>
            <button class="hb save" onclick="saveImage()">üíæ <span class="bl">Save</span></button>
            <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn" title="Toggle Theme">üåô</button>
        </div>
    </header>

    <div class="ed-body">
        <aside class="sidebar">
            <div class="tab-bar" id="tabBar">
                <div class="tb active" data-t="adjust"><span class="ti">üé®</span>Adjust</div>
                <div class="tb" data-t="filters"><span class="ti">‚ú®</span>Filters</div>
                <div class="tb" data-t="transform"><span class="ti">üîÑ</span>Transform</div>
                <div class="tb" data-t="draw"><span class="ti">üñåÔ∏è</span>Draw</div>
                <div class="tb" data-t="text"><span class="ti">üìù</span>Text</div>
                <div class="tb" data-t="crop"><span class="ti">‚úÇÔ∏è</span>Crop</div>
                <div class="tb" data-t="resize"><span class="ti">üìê</span>Resize</div>
                <div class="tb" data-t="export"><span class="ti">üíæ</span>Export</div>
            </div>
            <div class="panels">
                <!-- ADJUST -->
                <div class="pnl active" id="p-adjust">
                    <div class="pnl-title">üé® Adjustments</div>
                    <div class="sg"><div class="sl"><span>‚òÄÔ∏è Brightness</span><span class="sv" id="vb">0</span></div><input type="range" id="sb" min="-100" max="100" value="0"></div>
                    <div class="sg"><div class="sl"><span>üî≤ Contrast</span><span class="sv" id="vc">0</span></div><input type="range" id="sc" min="-100" max="100" value="0"></div>
                    <div class="sg"><div class="sl"><span>üåà Saturation</span><span class="sv" id="vs">0</span></div><input type="range" id="ss" min="-100" max="100" value="0"></div>
                    <div class="sg"><div class="sl"><span>üå°Ô∏è Temperature</span><span class="sv" id="vt">0</span></div><input type="range" id="st" min="-100" max="100" value="0"></div>
                    <div class="sg"><div class="sl"><span>üí° Exposure</span><span class="sv" id="ve">0</span></div><input type="range" id="se" min="-100" max="100" value="0"></div>
                    <div class="sg"><div class="sl"><span>üå´Ô∏è Blur</span><span class="sv" id="vbl">0px</span></div><input type="range" id="sbl" min="0" max="20" value="0"></div>
                    <div class="sg"><div class="sl"><span>üåë Vignette</span><span class="sv" id="vv">0</span></div><input type="range" id="sv" min="0" max="100" value="0"></div>
                    <button class="abtn dan" onclick="resetAdj()">üîÑ Reset Adjustments</button>
                </div>

                <!-- FILTERS -->
                <div class="pnl" id="p-filters">
                    <div class="pnl-title">‚ú® Filters</div>
                    <div class="fg" id="filterGrid">
                        <div class="fi active" data-f="none"><span class="fc">üñºÔ∏è</span>Original</div>
                        <div class="fi" data-f="grayscale"><span class="fc">‚¨õ</span>B&W</div>
                        <div class="fi" data-f="sepia"><span class="fc">üìú</span>Sepia</div>
                        <div class="fi" data-f="vintage"><span class="fc">üìª</span>Vintage</div>
                        <div class="fi" data-f="warm"><span class="fc">üî•</span>Warm</div>
                        <div class="fi" data-f="cool"><span class="fc">‚ùÑÔ∏è</span>Cool</div>
                        <div class="fi" data-f="dramatic"><span class="fc">üé≠</span>Dramatic</div>
                        <div class="fi" data-f="fade"><span class="fc">üåÅ</span>Fade</div>
                        <div class="fi" data-f="vivid"><span class="fc">üåü</span>Vivid</div>
                        <div class="fi" data-f="sunset"><span class="fc">üåÖ</span>Sunset</div>
                        <div class="fi" data-f="cinema"><span class="fc">üé¨</span>Cinema</div>
                        <div class="fi" data-f="invert"><span class="fc">üîÄ</span>Invert</div>
                        <div class="fi" data-f="neon"><span class="fc">üíú</span>Neon</div>
                        <div class="fi" data-f="blueprint"><span class="fc">üìò</span>Blueprint</div>
                        <div class="fi" data-f="emerald"><span class="fc">üíö</span>Emerald</div>
                    </div>
                    <div class="sg" style="margin-top:12px"><div class="sl"><span>Intensity</span><span class="sv" id="vfi">100%</span></div><input type="range" id="sfi" min="0" max="100" value="100"></div>
                </div>

                <!-- TRANSFORM -->
                <div class="pnl" id="p-transform">
                    <div class="pnl-title">üîÑ Rotate & Flip</div>
                    <div class="bg2">
                        <button class="gb" onclick="doRotate(90)"><span class="gi">‚Üª</span>90¬∞ Right</button>
                        <button class="gb" onclick="doRotate(-90)"><span class="gi">‚Ü∫</span>90¬∞ Left</button>
                        <button class="gb" onclick="doRotate(180)"><span class="gi">üîÉ</span>180¬∞</button>
                        <button class="gb" onclick="doFlip('h')"><span class="gi">‚ÜîÔ∏è</span>Flip H</button>
                        <button class="gb" onclick="doFlip('v')"><span class="gi">‚ÜïÔ∏è</span>Flip V</button>
                        <button class="gb" onclick="doRotate(45)"><span class="gi">üìê</span>45¬∞</button>
                    </div>
                </div>

                <!-- DRAW -->
                <div class="pnl" id="p-draw">
                    <div class="pnl-title">üñåÔ∏è Draw Tools</div>
                    <div class="bg2" id="drawModes">
                        <button class="gb active" data-m="brush"><span class="gi">üñåÔ∏è</span>Brush</button>
                        <button class="gb" data-m="eraser"><span class="gi">üßΩ</span>Eraser</button>
                        <button class="gb" data-m="line"><span class="gi">üìè</span>Line</button>
                        <button class="gb" data-m="rect"><span class="gi">‚¨ú</span>Rect</button>
                        <button class="gb" data-m="circle"><span class="gi">‚≠ï</span>Circle</button>
                        <button class="gb" data-m="arrow"><span class="gi">‚û°Ô∏è</span>Arrow</button>
                    </div>
                    <div class="cr" style="margin-top:10px"><label>Color</label><input type="color" id="dColor" value="#ff0000"></div>
                    <div class="cr"><label>Fill</label><input type="color" id="dFill" value="#ffff00"><label class="chk" style="min-width:auto;margin:0"><input type="checkbox" id="dUseFill"> Fill</label></div>
                    <div class="sg"><div class="sl"><span>Size</span><span class="sv" id="vbs">5px</span></div><input type="range" id="sbs" min="1" max="80" value="5"></div>
                    <div class="sg"><div class="sl"><span>Opacity</span><span class="sv" id="vdo">100%</span></div><input type="range" id="sdo" min="1" max="100" value="100"></div>
                    <button class="abtn dan" onclick="clearDraw()">üóëÔ∏è Clear Drawing</button>
                </div>

                <!-- TEXT -->
                <div class="pnl" id="p-text">
                    <div class="pnl-title">üìù Add Text</div>
                    <div class="fg2"><label>Text</label><textarea id="txtC" placeholder="Type here...">Hello World</textarea></div>
                    <div class="fg2"><label>Font</label><select id="txtF"><option>Arial</option><option>Verdana</option><option>Georgia</option><option>Times New Roman</option><option>Courier New</option><option>Impact</option><option>Trebuchet MS</option><option>Comic Sans MS</option></select></div>
                    <div class="sg"><div class="sl"><span>Size</span><span class="sv" id="vts">40px</span></div><input type="range" id="sts" min="10" max="300" value="40"></div>
                    <div class="cr"><label>Color</label><input type="color" id="txtCol" value="#ffffff"></div>
                    <div class="cr"><label>Outline</label><input type="color" id="txtOut" value="#000000"></div>
                    <div class="sg"><div class="sl"><span>Outline W</span><span class="sv" id="vto">2px</span></div><input type="range" id="sto" min="0" max="15" value="2"></div>
                    <div class="bg2" style="margin-bottom:8px">
                        <button class="gb" id="bBold" onclick="this.classList.toggle('active')"><b>B</b> Bold</button>
                        <button class="gb" id="bItalic" onclick="this.classList.toggle('active')"><i>I</i> Italic</button>
                    </div>
                    <button class="abtn pri" onclick="startTextMode()">üìù Click Image to Place</button>
                </div>

                <!-- CROP -->
                <div class="pnl" id="p-crop">
                    <div class="pnl-title">‚úÇÔ∏è Crop</div>
                    <div class="bg2" id="cropRatios">
                        <button class="gb active" data-r="free">üîì Free</button>
                        <button class="gb" data-r="1:1">‚¨ú 1:1</button>
                        <button class="gb" data-r="4:3">üñºÔ∏è 4:3</button>
                        <button class="gb" data-r="16:9">üì∫ 16:9</button>
                        <button class="gb" data-r="3:2">üì∑ 3:2</button>
                        <button class="gb" data-r="9:16">üì± 9:16</button>
                    </div>
                    <div class="row2" style="margin-top:10px"><div class="fg2"><label>X</label><input type="number" id="cX" value="0" min="0"></div><div class="fg2"><label>Y</label><input type="number" id="cY" value="0" min="0"></div></div>
                    <div class="row2"><div class="fg2"><label>Width</label><input type="number" id="cW" value="200" min="1"></div><div class="fg2"><label>Height</label><input type="number" id="cH" value="200" min="1"></div></div>
                    <button class="abtn suc" onclick="applyCrop()">‚úÖ Apply Crop</button>
                </div>

                <!-- RESIZE -->
                <div class="pnl" id="p-resize">
                    <div class="pnl-title">üìê Resize</div>
                    <div class="row2"><div class="fg2"><label>Width (px)</label><input type="number" id="rW" min="1"></div><div class="fg2"><label>Height (px)</label><input type="number" id="rH" min="1"></div></div>
                    <label class="chk"><input type="checkbox" id="lockR" checked> üîí Lock Aspect Ratio</label>
                    <button class="abtn pri" onclick="applyResize()">üìê Apply Resize</button>
                </div>

                <!-- EXPORT -->
                <div class="pnl" id="p-export">
                    <div class="pnl-title">üíæ Export</div>
                    <div class="fg2"><label>File Name</label><input type="text" id="eName" value="toolmatrix-photo"></div>
                    <div class="pnl-title" style="margin-top:10px">Format</div>
                    <div class="bg2" id="fmtBtns">
                        <button class="gb active" data-fmt="png">PNG</button>
                        <button class="gb" data-fmt="jpeg">JPEG</button>
                        <button class="gb" data-fmt="webp">WebP</button>
                        <button class="gb" data-fmt="bmp">BMP</button>
                    </div>
                    <div class="sg" style="margin-top:10px"><div class="sl"><span>Quality</span><span class="sv" id="veq">92%</span></div><input type="range" id="seq" min="10" max="100" value="92"></div>
                    <button class="abtn suc" onclick="exportImg()">üíæ Download Image</button>
                    <div class="pnl-title" style="margin-top:14px">üìä Info</div>
                    <div style="font-size:0.8rem;color:var(--text3);line-height:2">
                        üìê <strong id="iDim" style="color:var(--accent)">-</strong><br>
                        üìÑ <strong id="iFmt" style="color:var(--accent)">PNG</strong>
                    </div>
                </div>
            </div>
        </aside>

        <main class="canvas-area" id="canvasArea">
            <div class="upload-screen" id="upScreen">
                <div class="drop-zone" id="dropZone" onclick="openFile()">
                    <span class="ui">üì∑</span>
                    <h2>Upload Your Photo</h2>
                    <p>Drag & drop or click to browse<br><small>JPG, PNG, GIF, BMP, WebP supported</small></p>
                    <div class="bbtn">üìÅ Choose Image</div>
                </div>
            </div>
            <div class="canvas-box" id="canvasBox">
                <canvas id="mainCanvas"></canvas>
                <canvas id="drawCanvas"></canvas>
            </div>
            <div class="info-bar" id="infoBar"><span id="dimTxt">-</span></div>
        </main>
    </div>
</div>

<!-- ===== PAGE CONTENT ===== -->
<div class="page-content">
    <div class="cw">

        <article class="seo-box">
            <h2>Free Online Photo Editor by ToolMatrix</h2>
            <p><strong>ToolMatrix Photo Editor</strong> is a powerful, free online image editing tool that runs directly in your browser. No downloads, no sign-ups, no watermarks. Edit your photos professionally with comprehensive tools including color adjustments, filters, drawing, text overlay, crop, resize, and more.</p>

            <h2>Key Features</h2>
            <h3>üé® Color Adjustments</h3>
            <p>Fine-tune your images with 7 professional controls: Brightness, Contrast, Saturation, Temperature, Exposure, Blur, and Vignette. All changes happen in real-time using pixel-level processing.</p>
            <h3>‚ú® 15 Photo Filters</h3>
            <p>Apply stunning one-click filters including B&W, Sepia, Vintage, Warm, Cool, Dramatic, Fade, Vivid, Sunset, Cinema, Invert, Neon, Blueprint, and Emerald. Adjust filter intensity with a dedicated slider.</p>
            <h3>üñåÔ∏è Drawing Tools</h3>
            <p>Draw directly on images with Brush, Eraser, Line, Rectangle, Circle, and Arrow tools. Full control over color, fill, size, and opacity.</p>
            <h3>üìù Text Overlay</h3>
            <p>Add custom text with multiple fonts, sizes, colors, outlines, bold and italic options. Click anywhere on the image to place text precisely.</p>
            <h3>‚úÇÔ∏è Crop & üìê Resize</h3>
            <p>Crop with preset ratios (1:1, 4:3, 16:9, 3:2, 9:16) or custom dimensions. Resize to exact pixel dimensions with aspect ratio lock.</p>

            <h2>How to Use</h2>
            <ol>
                <li><strong>Upload</strong> ‚Äî Click "Open" or drag & drop your image into the editor</li>
                <li><strong>Edit</strong> ‚Äî Use sidebar tools to adjust, filter, draw, add text, crop, or resize</li>
                <li><strong>Save</strong> ‚Äî Export as PNG, JPEG, WebP, or BMP with custom quality</li>
            </ol>

            <h2>Why Choose ToolMatrix Photo Editor?</h2>
            <ul>
                <li>‚úÖ 100% Free ‚Äî No hidden charges or premium plans</li>
                <li>‚úÖ No Registration ‚Äî Start editing immediately</li>
                <li>‚úÖ No Watermarks ‚Äî Clean exports every time</li>
                <li>‚úÖ Privacy First ‚Äî All processing in your browser</li>
                <li>‚úÖ Light & Dark Theme ‚Äî Edit comfortably day or night</li>
                <li>‚úÖ Mobile Optimized ‚Äî Full-screen editing on any device</li>
                <li>‚úÖ Undo/Redo ‚Äî Never worry about mistakes</li>
                <li>‚úÖ Multiple Export Formats ‚Äî PNG, JPEG, WebP, BMP</li>
            </ul>
        </article>

        <!-- RELATED TOOLS -->
        <div class="seo-box">
            <h2 style="margin-top:0;border:none;padding:0">üõ†Ô∏è Related Tools from ToolMatrix</h2>
            <div class="rt-grid">
                <a href="/age-calculator" class="rt-card"><div class="rt-ico">üéÇ</div><div class="rt-name">Age Calculator</div><div class="rt-desc">Calculate your exact age in years, months, days, hours, minutes & seconds.</div><div class="rt-arr">Try it ‚Üí</div></a>
                <a href="/sip-calculator" class="rt-card"><div class="rt-ico">üìà</div><div class="rt-name">SIP Calculator</div><div class="rt-desc">Calculate SIP returns and see how your investments grow with compound interest.</div><div class="rt-arr">Try it ‚Üí</div></a>
                <a href="/tip-calculator" class="rt-card"><div class="rt-ico">üí∞</div><div class="rt-name">Tip Calculator</div><div class="rt-desc">Calculate tips instantly. Split bills among friends with perfect accuracy.</div><div class="rt-arr">Try it ‚Üí</div></a>
                <a href="/loan-emi-calculator" class="rt-card"><div class="rt-ico">üè¶</div><div class="rt-name">Loan EMI Calculator</div><div class="rt-desc">Calculate monthly EMI for home, car & personal loans with amortization schedule.</div><div class="rt-arr">Try it ‚Üí</div></a>
            </div>
        </div>

        <!-- FAQ -->
        <div class="seo-box">
            <h2 style="margin-top:0;text-align:center;border:none;padding:0">‚ùì Frequently Asked Questions</h2>
            <div style="margin-top:20px">
                <div class="fq-item"><div class="fq-q" onclick="this.parentElement.classList.toggle('open')">Is this photo editor completely free?</div><div class="fq-a">Yes! ToolMatrix Photo Editor is 100% free. No watermarks, no premium plans, no registration required.</div></div>
                <div class="fq-item"><div class="fq-q" onclick="this.parentElement.classList.toggle('open')">Do I need to install any software?</div><div class="fq-a">No. It runs entirely in your browser ‚Äî Chrome, Firefox, Safari, Edge all supported.</div></div>
                <div class="fq-item"><div class="fq-q" onclick="this.parentElement.classList.toggle('open')">Are my photos uploaded to any server?</div><div class="fq-a">No. All processing happens locally using HTML5 Canvas. Your photos never leave your device.</div></div>
                <div class="fq-item"><div class="fq-q" onclick="this.parentElement.classList.toggle('open')">What image formats are supported?</div><div class="fq-a">Import: JPG, PNG, GIF, BMP, WebP, SVG. Export: PNG, JPEG, WebP, BMP.</div></div>
                <div class="fq-item"><div class="fq-q" onclick="this.parentElement.classList.toggle('open')">Does it work on mobile phones?</div><div class="fq-a">Yes! Fully responsive with touch support for drawing and text placement.</div></div>
                <div class="fq-item"><div class="fq-q" onclick="this.parentElement.classList.toggle('open')">Can I switch between light and dark themes?</div><div class="fq-a">Yes! Click the moon/sun icon in the header to toggle between light and dark mode.</div></div>
                <div class="fq-item"><div class="fq-q" onclick="this.parentElement.classList.toggle('open')">Can I undo my edits?</div><div class="fq-a">Yes, full undo/redo support. Use the ‚Ü©Ô∏è and ‚Ü™Ô∏è buttons or reset everything.</div></div>
                <div class="fq-item"><div class="fq-q" onclick="this.parentElement.classList.toggle('open')">Is there a file size limit?</div><div class="fq-a">No hard limit. Performance depends on your device. We recommend images under 5000√ó5000px.</div></div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="site-footer">
        <div class="ft-main">
            <div class="ft-col ft-brand">
                <div class="bn"><div class="bi">üß∞</div><span>ToolMatrix</span></div>
                <p>Your one-stop destination for free online tools and calculators. Fast, accurate, and easy-to-use.</p>
                
                </div>
            
            </div>
            <div class="ft-col">
                
            <div class="ft-col">
                <h3>Stay Updated</h3>
                <p style="font-size:0.83rem;color:var(--text3);line-height:1.5;margin-bottom:8px">Subscribe to get notified about new tools.</p>
                <form class="nl-form" onsubmit="event.preventDefault();subNL()">
                    <input type="email" id="nlEmail" placeholder="Your email" required>
                    <button type="submit">Subscribe</button>
                </form>
                <div class="nl-msg" id="nlMsg">‚úÖ Subscribed!</div>
            </div>
        </div>
        <div class="ft-bottom">
            <div class="ft-bottom-inner">
                <p>&copy; 2026 <a href="/">ToolMatrix</a>. All rights reserved. Design by <a href="/">ToolMatrix</a> ‚ù§Ô∏è</p>
                <div class="ft-blinks">
                    <a href="/privacy-policy">Privacy Policy</a>
                    <a href="/terms">Terms of Service</a>
                    
                </div>
            </div>
        </div>
    </footer>
</div>

<!-- ===== JAVASCRIPT ===== -->
<script>
const MC=document.getElementById('mainCanvas'),MX=MC.getContext('2d');
const DC=document.getElementById('drawCanvas'),DX=DC.getContext('2d');
let origImg=null,hist=[],hIdx=-1,curDraw='brush',drawing=false,dsx=0,dsy=0;
let textMode=false,expFmt='png',curFilter='none',shapeSS=null;

// ===== THEME =====
function toggleTheme(){
    const c=document.documentElement.getAttribute('data-theme');
    const n=c==='dark'?'light':'dark';
    document.documentElement.setAttribute('data-theme',n);
    document.getElementById('themeBtn').textContent=n==='dark'?'‚òÄÔ∏è':'üåô';
    localStorage.setItem('tm-theme',n);
}
(function(){const s=localStorage.getItem('tm-theme');if(s){document.documentElement.setAttribute('data-theme',s);if(s==='dark')document.getElementById('themeBtn').textContent='‚òÄÔ∏è';}})();

// ===== TOAST =====
function toast(m,t='info'){const e=document.getElementById('toast');e.textContent=m;e.className='toast '+t+' show';setTimeout(()=>e.classList.remove('show'),2500)}

// ===== FILE =====
function openFile(){document.getElementById('fileInput').click()}
document.getElementById('fileInput').addEventListener('change',function(){
    const f=this.files[0];if(!f)return;
    if(!f.type.startsWith('image/')){toast('Select an image!','err');return}
    const r=new FileReader();
    r.onload=function(e){
        const img=new Image();
        img.onload=function(){
            origImg=img;
            MC.width=img.width;MC.height=img.height;
            MX.clearRect(0,0,img.width,img.height);MX.drawImage(img,0,0);
            DC.width=img.width;DC.height=img.height;DX.clearRect(0,0,img.width,img.height);
            syncDC();
            document.getElementById('upScreen').style.display='none';
            document.getElementById('canvasBox').style.display='block';
            document.getElementById('infoBar').style.display='block';
            updInfo();resetAdj();hist=[];hIdx=-1;pushH();
            toast('Image loaded!','ok');
        };img.src=e.target.result;
    };r.readAsDataURL(f);this.value='';
});

function syncDC(){DC.style.width=MC.offsetWidth+'px';DC.style.height=MC.offsetHeight+'px'}
new ResizeObserver(syncDC).observe(MC);

// Drag & Drop
const dz=document.getElementById('dropZone'),ca=document.getElementById('canvasArea');
['dragenter','dragover','dragleave','drop'].forEach(e=>{ca.addEventListener(e,ev=>{ev.preventDefault();ev.stopPropagation()});dz.addEventListener(e,ev=>{ev.preventDefault();ev.stopPropagation()})});
['dragenter','dragover'].forEach(e=>dz.addEventListener(e,()=>dz.classList.add('drag')));
['dragleave','drop'].forEach(e=>dz.addEventListener(e,()=>dz.classList.remove('drag')));
ca.addEventListener('drop',e=>{const fs=e.dataTransfer.files;if(fs.length&&fs[0].type.startsWith('image/')){const dt=new DataTransfer();dt.items.add(fs[0]);document.getElementById('fileInput').files=dt.files;document.getElementById('fileInput').dispatchEvent(new Event('change'))}});

// ===== TABS =====
document.getElementById('tabBar').addEventListener('click',function(e){
    const t=e.target.closest('.tb');if(!t)return;
    document.querySelectorAll('.tb').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.pnl').forEach(p=>p.classList.remove('active'));
    t.classList.add('active');
    document.getElementById('p-'+t.dataset.t).classList.add('active');
    textMode=false;
    DC.style.pointerEvents=(t.dataset.t==='draw')?'auto':'none';
});

// ===== SLIDER DISPLAY =====
const SM={'sb':'vb','sc':'vc','ss':'vs','st':'vt','se':'ve','sbl':'vbl','sv':'vv','sfi':'vfi','sbs':'vbs','sdo':'vdo','sts':'vts','sto':'vto','seq':'veq'};
const SX={'sbl':'px','sfi':'%','sbs':'px','sdo':'%','sts':'px','sto':'px','seq':'%'};
Object.keys(SM).forEach(id=>{
    const el=document.getElementById(id);if(!el)return;
    el.addEventListener('input',function(){
        document.getElementById(SM[id]).textContent=this.value+(SX[id]||'');
        if(['sb','sc','ss','st','se','sbl','sv'].includes(id)||id==='sfi')applyAll();
    });
});

// ===== ADJUSTMENTS (pixel level) =====
function applyAll(){
    if(!origImg)return;
    const b=+document.getElementById('sb').value,c=+document.getElementById('sc').value;
    const s=+document.getElementById('ss').value,t=+document.getElementById('st').value;
    const ex=+document.getElementById('se').value,bl=+document.getElementById('sbl').value;
    const vi=+document.getElementById('sv').value,fi=+document.getElementById('sfi').value/100;

    MX.clearRect(0,0,MC.width,MC.height);
    MX.drawImage(origImg,0,0,MC.width,MC.height);
    let id=MX.getImageData(0,0,MC.width,MC.height),d=id.data;
    const w=MC.width,h=MC.height;

    if(curFilter!=='none')filterPx(d,curFilter,fi);

    for(let i=0;i<d.length;i+=4){
        let r=d[i],g=d[i+1],bb=d[i+2];
        r+=b*2.55;g+=b*2.55;bb+=b*2.55;
        const ef=Math.pow(2,ex/50);r*=ef;g*=ef;bb*=ef;
        const cf=(259*(c+255))/(255*(259-c));
        r=cf*(r-128)+128;g=cf*(g-128)+128;bb=cf*(bb-128)+128;
        r+=t*1.5;bb-=t*1.5;
        const gr=0.299*r+0.587*g+0.114*bb,sf=1+s/100;
        r=gr+sf*(r-gr);g=gr+sf*(g-gr);bb=gr+sf*(bb-gr);
        if(vi>0){const px=(i/4)%w,py=Math.floor((i/4)/w),cx=w/2,cy=h/2;
            const md=Math.sqrt(cx*cx+cy*cy),ds=Math.sqrt((px-cx)**2+(py-cy)**2);
            const vf=1-(vi/100)*Math.pow(ds/md,2);r*=vf;g*=vf;bb*=vf;}
        d[i]=Math.max(0,Math.min(255,r));d[i+1]=Math.max(0,Math.min(255,g));d[i+2]=Math.max(0,Math.min(255,bb));
    }
    MX.putImageData(id,0,0);

    if(bl>0){const tc=document.createElement('canvas');tc.width=w;tc.height=h;
        const tx=tc.getContext('2d');tx.filter='blur('+bl+'px)';tx.drawImage(MC,0,0);
        MX.clearRect(0,0,w,h);MX.drawImage(tc,0,0);}
}

function filterPx(d,f,int){
    for(let i=0;i<d.length;i+=4){
        let r=d[i],g=d[i+1],b=d[i+2],nr=r,ng=g,nb=b;
        switch(f){
            case'grayscale':{const gr=.299*r+.587*g+.114*b;nr=ng=nb=gr;break}
            case'sepia':{nr=r*.393+g*.769+b*.189;ng=r*.349+g*.686+b*.168;nb=r*.272+g*.534+b*.131;break}
            case'vintage':{nr=r*.62+g*.32+b*.17+20;ng=r*.22+g*.7+b*.12+10;nb=r*.15+g*.28+b*.45+5;break}
            case'warm':{nr=r+30;ng=g+10;nb=b-20;break}
            case'cool':{nr=r-20;ng=g+5;nb=b+30;break}
            case'dramatic':{const c2=1.5;nr=c2*(r-128)+138;ng=c2*(g-128)+128;nb=c2*(b-128)+118;break}
            case'fade':{nr=r*.8+50;ng=g*.8+50;nb=b*.8+50;break}
            case'vivid':{const g2=.299*r+.587*g+.114*b,s2=1.8,c3=1.2;nr=c3*(g2+s2*(r-g2)-128)+128;ng=c3*(g2+s2*(g-g2)-128)+128;nb=c3*(g2+s2*(b-g2)-128)+128;break}
            case'sunset':{nr=r+40;ng=g+15;nb=b-30;break}
            case'cinema':{const c4=1.15;nr=c4*(r*.9+15-128)+128;ng=c4*(g*.85+10-128)+128;nb=c4*(b*1.1+5-128)+128;break}
            case'invert':{nr=255-r;ng=255-g;nb=255-b;break}
            case'neon':{const g3=.299*r+.587*g+.114*b;nr=g3+2.5*(r-g3)+20;ng=g3+2.5*(g-g3);nb=g3+2.5*(b-g3)+40;break}
            case'blueprint':{const g4=.299*r+.587*g+.114*b;nr=g4*.2;ng=g4*.4;nb=g4*1.2+30;break}
            case'emerald':{const g5=.299*r+.587*g+.114*b;nr=g5*.2;ng=g5*1.1+20;nb=g5*.3;break}
        }
        d[i]=Math.max(0,Math.min(255,r+(nr-r)*int));
        d[i+1]=Math.max(0,Math.min(255,g+(ng-g)*int));
        d[i+2]=Math.max(0,Math.min(255,b+(nb-b)*int));
    }
}

function resetAdj(){
    ['sb','sc','ss','st','se','sv'].forEach(id=>{document.getElementById(id).value=0});
    document.getElementById('sbl').value=0;document.getElementById('sfi').value=100;
    curFilter='none';
    document.querySelectorAll('.fi').forEach(f=>f.classList.remove('active'));
    document.querySelector('.fi[data-f="none"]').classList.add('active');
    Object.keys(SM).forEach(id=>{const el=document.getElementById(SM[id]),sl=document.getElementById(id);if(el&&sl)el.textContent=sl.value+(SX[id]||'')});
    if(origImg)applyAll();
}

// ===== FILTERS =====
document.getElementById('filterGrid').addEventListener('click',function(e){
    const it=e.target.closest('.fi');if(!it||!origImg){if(!origImg)toast('Upload image first!','err');return}
    document.querySelectorAll('.fi').forEach(f=>f.classList.remove('active'));
    it.classList.add('active');curFilter=it.dataset.f;applyAll();pushH();toast('Filter: '+curFilter,'ok');
});

// ===== TRANSFORM =====
function flatten(){MX.drawImage(DC,0,0);DX.clearRect(0,0,DC.width,DC.height)}
function updOrig(){const img=new Image();img.onload=()=>{origImg=img};img.src=MC.toDataURL()}

function doRotate(deg){
    if(!origImg){toast('Upload image first!','err');return}
    flatten();
    const rad=deg*Math.PI/180,sin=Math.abs(Math.sin(rad)),cos=Math.abs(Math.cos(rad));
    const ow=MC.width,oh=MC.height,nw=Math.round(ow*cos+oh*sin),nh=Math.round(ow*sin+oh*cos);
    const tc=document.createElement('canvas');tc.width=ow;tc.height=oh;tc.getContext('2d').drawImage(MC,0,0);
    MC.width=nw;MC.height=nh;MX.clearRect(0,0,nw,nh);MX.translate(nw/2,nh/2);MX.rotate(rad);
    MX.drawImage(tc,-ow/2,-oh/2);MX.setTransform(1,0,0,1,0,0);
    DC.width=nw;DC.height=nh;DX.clearRect(0,0,nw,nh);syncDC();updOrig();updInfo();pushH();toast('Rotated '+deg+'¬∞','ok');
}

function doFlip(dir){
    if(!origImg){toast('Upload image first!','err');return}
    flatten();const w=MC.width,h=MC.height;
    const tc=document.createElement('canvas');tc.width=w;tc.height=h;tc.getContext('2d').drawImage(MC,0,0);
    MX.clearRect(0,0,w,h);
    if(dir==='h'){MX.translate(w,0);MX.scale(-1,1)}else{MX.translate(0,h);MX.scale(1,-1)}
    MX.drawImage(tc,0,0);MX.setTransform(1,0,0,1,0,0);updOrig();pushH();toast('Flipped!','ok');
}

// ===== DRAWING =====
DC.style.pointerEvents='none';
document.getElementById('drawModes').addEventListener('click',function(e){
    const b=e.target.closest('.gb');if(!b)return;
    document.querySelectorAll('#drawModes .gb').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');curDraw=b.dataset.m;
});

function gCoord(e){
    const r=DC.getBoundingClientRect(),sx=DC.width/r.width,sy=DC.height/r.height;
    let cx,cy;if(e.touches){cx=e.touches[0].clientX;cy=e.touches[0].clientY}else{cx=e.clientX;cy=e.clientY}
    return{x:(cx-r.left)*sx,y:(cy-r.top)*sy};
}

DC.addEventListener('mousedown',dsStart);DC.addEventListener('mousemove',dsMove);
DC.addEventListener('mouseup',dsEnd);DC.addEventListener('mouseleave',dsEnd);
DC.addEventListener('touchstart',e=>{e.preventDefault();dsStart(e)},{passive:false});
DC.addEventListener('touchmove',e=>{e.preventDefault();dsMove(e)},{passive:false});
DC.addEventListener('touchend',e=>{e.preventDefault();dsEnd(e)});

function dsStart(e){
    if(!origImg)return;drawing=true;const co=gCoord(e);dsx=co.x;dsy=co.y;
    if(curDraw==='brush'||curDraw==='eraser'){DX.beginPath();DX.moveTo(co.x,co.y)}
    else{shapeSS=DX.getImageData(0,0,DC.width,DC.height)}
}

function dsMove(e){
    if(!drawing)return;const co=gCoord(e);
    const col=document.getElementById('dColor').value,sz=+document.getElementById('sbs').value;
    const op=+document.getElementById('sdo').value/100;
    DX.globalAlpha=op;
    if(curDraw==='brush'){
        DX.globalCompositeOperation='source-over';DX.strokeStyle=col;DX.lineWidth=sz;
        DX.lineCap='round';DX.lineJoin='round';DX.lineTo(co.x,co.y);DX.stroke();
    }else if(curDraw==='eraser'){
        DX.globalCompositeOperation='destination-out';DX.lineWidth=sz;DX.lineCap='round';
        DX.lineTo(co.x,co.y);DX.stroke();DX.globalCompositeOperation='source-over';
    }else if(shapeSS){
        DX.putImageData(shapeSS,0,0);DX.globalAlpha=op;DX.strokeStyle=col;DX.lineWidth=sz;DX.lineCap='round';
        const fc=document.getElementById('dFill').value,uf=document.getElementById('dUseFill').checked;
        if(curDraw==='line'){DX.beginPath();DX.moveTo(dsx,dsy);DX.lineTo(co.x,co.y);DX.stroke()}
        else if(curDraw==='rect'){const rw=co.x-dsx,rh=co.y-dsy;if(uf){DX.fillStyle=fc;DX.fillRect(dsx,dsy,rw,rh)}DX.strokeRect(dsx,dsy,rw,rh)}
        else if(curDraw==='circle'){const rd=Math.sqrt((co.x-dsx)**2+(co.y-dsy)**2);DX.beginPath();DX.arc(dsx,dsy,rd,0,Math.PI*2);if(uf){DX.fillStyle=fc;DX.fill()}DX.stroke()}
        else if(curDraw==='arrow'){drawArr(DX,dsx,dsy,co.x,co.y,sz,col)}
    }
    DX.globalAlpha=1;
}

function dsEnd(){if(!drawing)return;drawing=false;shapeSS=null;DX.beginPath();pushH()}

function drawArr(ctx,fx,fy,tx,ty,w,col){
    const hl=w*4,a=Math.atan2(ty-fy,tx-fx);
    ctx.strokeStyle=col;ctx.lineWidth=w;ctx.beginPath();ctx.moveTo(fx,fy);ctx.lineTo(tx,ty);ctx.stroke();
    ctx.fillStyle=col;ctx.beginPath();ctx.moveTo(tx,ty);
    ctx.lineTo(tx-hl*Math.cos(a-Math.PI/6),ty-hl*Math.sin(a-Math.PI/6));
    ctx.lineTo(tx-hl*Math.cos(a+Math.PI/6),ty-hl*Math.sin(a+Math.PI/6));ctx.closePath();ctx.fill();
}

function clearDraw(){DX.clearRect(0,0,DC.width,DC.height);pushH();toast('Drawing cleared','ok')}

// ===== TEXT =====
function startTextMode(){if(!origImg){toast('Upload image first!','err');return}textMode=true;toast('Click on image to place text','info')}

MC.addEventListener('click',function(e){if(!textMode||!origImg)return;
    const r=MC.getBoundingClientRect(),sx=MC.width/r.width,sy=MC.height/r.height;
    placeText((e.clientX-r.left)*sx,(e.clientY-r.top)*sy);
});
MC.addEventListener('touchstart',function(e){if(!textMode||!origImg)return;e.preventDefault();
    const tc=e.touches[0],r=MC.getBoundingClientRect(),sx=MC.width/r.width,sy=MC.height/r.height;
    placeText((tc.clientX-r.left)*sx,(tc.clientY-r.top)*sy);
},{passive:false});

function placeText(x,y){
    const txt=document.getElementById('txtC').value;if(!txt.trim()){toast('Enter text!','err');return}
    flatten();
    const font=document.getElementById('txtF').value,sz=+document.getElementById('sts').value;
    const col=document.getElementById('txtCol').value,out=document.getElementById('txtOut').value;
    const ow=+document.getElementById('sto').value;
    const bold=document.getElementById('bBold').classList.contains('active');
    const italic=document.getElementById('bItalic').classList.contains('active');
    let fs='';if(italic)fs+='italic ';if(bold)fs+='bold ';fs+=sz+'px "'+font+'"';
    MX.font=fs;MX.textBaseline='top';
    txt.split('\n').forEach((ln,i)=>{
        const ly=y+i*sz*1.3;
        if(ow>0){MX.strokeStyle=out;MX.lineWidth=ow;MX.lineJoin='round';MX.strokeText(ln,x,ly)}
        MX.fillStyle=col;MX.fillText(ln,x,ly);
    });
    textMode=false;updOrig();pushH();toast('Text added!','ok');
}

// ===== CROP =====
document.getElementById('cropRatios').addEventListener('click',function(e){
    const b=e.target.closest('.gb');if(!b||!origImg)return;
    document.querySelectorAll('#cropRatios .gb').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    const ra=b.dataset.r,cw=MC.width,ch=MC.height;let w,h;
    if(ra==='free'){w=cw*.8;h=ch*.8}
    else{const p=ra.split(':').map(Number),r=p[0]/p[1];if(cw/ch>r){h=ch*.8;w=h*r}else{w=cw*.8;h=w/r}}
    document.getElementById('cX').value=Math.round((cw-w)/2);document.getElementById('cY').value=Math.round((ch-h)/2);
    document.getElementById('cW').value=Math.round(w);document.getElementById('cH').value=Math.round(h);
});

function applyCrop(){
    if(!origImg){toast('Upload image first!','err');return}
    flatten();
    const x=+document.getElementById('cX').value||0,y=+document.getElementById('cY').value||0;
    const w=+document.getElementById('cW').value,h=+document.getElementById('cH').value;
    if(!w||!h||w<1||h<1){toast('Invalid size!','err');return}
    if(x<0||y<0||x+w>MC.width||y+h>MC.height){toast('Crop exceeds bounds!','err');return}
    const id=MX.getImageData(x,y,w,h);MC.width=w;MC.height=h;MX.putImageData(id,0,0);
    DC.width=w;DC.height=h;DX.clearRect(0,0,w,h);syncDC();updOrig();updInfo();pushH();toast('Cropped!','ok');
}

// ===== RESIZE =====
(function(){
    const rw=document.getElementById('rW'),rh=document.getElementById('rH');
    rw.addEventListener('input',function(){if(origImg&&document.getElementById('lockR').checked){rh.value=Math.round(this.value*(origImg.height/origImg.width))}});
    rh.addEventListener('input',function(){if(origImg&&document.getElementById('lockR').checked){rw.value=Math.round(this.value*(origImg.width/origImg.height))}});
})();

function applyResize(){
    if(!origImg){toast('Upload image first!','err');return}
    flatten();const nw=+document.getElementById('rW').value,nh=+document.getElementById('rH').value;
    if(!nw||!nh||nw<1||nh<1){toast('Enter valid size!','err');return}
    if(nw>10000||nh>10000){toast('Max 10000px!','err');return}
    const tc=document.createElement('canvas');tc.width=MC.width;tc.height=MC.height;tc.getContext('2d').drawImage(MC,0,0);
    MC.width=nw;MC.height=nh;MX.drawImage(tc,0,0,nw,nh);
    DC.width=nw;DC.height=nh;DX.clearRect(0,0,nw,nh);syncDC();updOrig();updInfo();pushH();toast('Resized to '+nw+'√ó'+nh,'ok');
}

// ===== EXPORT =====
document.getElementById('fmtBtns').addEventListener('click',function(e){
    const b=e.target.closest('.gb');if(!b)return;
    document.querySelectorAll('#fmtBtns .gb').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');expFmt=b.dataset.fmt;document.getElementById('iFmt').textContent=expFmt.toUpperCase();
});

function saveImage(){exportImg()}
function exportImg(){
    if(!origImg){toast('Upload image first!','err');return}
    const ec=document.createElement('canvas');ec.width=MC.width;ec.height=MC.height;
    const ex=ec.getContext('2d');ex.drawImage(MC,0,0);ex.drawImage(DC,0,0);
    const nm=document.getElementById('eName').value||'toolmatrix-photo',q=+document.getElementById('seq').value/100;
    let mime,ext;
    switch(expFmt){case'jpeg':mime='image/jpeg';ext='jpg';break;case'webp':mime='image/webp';ext='webp';break;case'bmp':mime='image/bmp';ext='bmp';break;default:mime='image/png';ext='png'}
    const a=document.createElement('a');a.download=nm+'.'+ext;a.href=ec.toDataURL(mime,q);
    document.body.appendChild(a);a.click();document.body.removeChild(a);toast('Downloaded!','ok');
}

// ===== UNDO/REDO =====
function pushH(){
    if(!origImg)return;if(hIdx<hist.length-1)hist=hist.slice(0,hIdx+1);
    if(hist.length>40)hist.shift();
    hist.push({m:MC.toDataURL(),d:DC.toDataURL(),w:MC.width,h:MC.height});hIdx=hist.length-1;
}

function undo(){if(hIdx<=0){toast('Nothing to undo','info');return}hIdx--;restoreH();toast('Undo','info')}
function redo(){if(hIdx>=hist.length-1){toast('Nothing to redo','info');return}hIdx++;restoreH();toast('Redo','info')}

function restoreH(){
    const st=hist[hIdx],i1=new Image();
    i1.onload=()=>{MC.width=st.w;MC.height=st.h;MX.clearRect(0,0,st.w,st.h);MX.drawImage(i1,0,0);
        DC.width=st.w;DC.height=st.h;
        const i2=new Image();i2.onload=()=>{DX.clearRect(0,0,st.w,st.h);DX.drawImage(i2,0,0);syncDC()};i2.src=st.d;
        updOrig();updInfo();
    };i1.src=st.m;
}

function resetAll(){
    if(!origImg)return;if(hist.length>0){
        const f=hist[0],img=new Image();
        img.onload=()=>{MC.width=f.w;MC.height=f.h;MX.clearRect(0,0,f.w,f.h);MX.drawImage(img,0,0);
            DC.width=f.w;DC.height=f.h;DX.clearRect(0,0,f.w,f.h);syncDC();
            updOrig();updInfo();resetAdj();hist=[];hIdx=-1;pushH();toast('Reset!','ok');
        };img.src=f.m;
    }
}

// ===== HELPERS =====
function updInfo(){
    const t=MC.width+'√ó'+MC.height+'px';
    document.getElementById('dimTxt').textContent=t;document.getElementById('iDim').textContent=t;
    document.getElementById('rW').placeholder=MC.width;document.getElementById('rH').placeholder=MC.height;
}

function subNL(){
    const e=document.getElementById('nlEmail');if(e.value){
        document.getElementById('nlMsg').style.display='block';e.value='';
        setTimeout(()=>document.getElementById('nlMsg').style.display='none',3000);
    }
}
</script>

</body>
</html>
